import{r as e,R as s,j as a,p as r,q as t,k as n,s as i,B as l,T as o,t as c,x as d,d as x,C as h,m,n as u,o as p,y as j}from"./mui-core-CIRgtlGz.js";import{a as f,C as g,P as b,S as y}from"./mui-icons-BQP8OJas.js";import{c as v,A as C,U as w,R as _,b as S}from"../index-Dz5qx50A.js";import{f as A,e as z}from"./skillsCache-DGpitEsO.js";import{u as k}from"./useConversations-CjQ7vxVG.js";import{b as I}from"./vendor-CoiQIOlL.js";import"./http-Dos3PyFQ.js";const P=s.memo(({friend:s})=>{const m=I(),{getOrCreateConversation:u}=k(),[p,j]=e.useState(!1),{id:b,nombre:y="Usuario",apellido:v="",email:C="",media:w,foto_perfil:S,habilidades_ofrecer:A=[],habilidades_aprender:z=[]}=s,P=w||S,R=e.useCallback(()=>{m(_.USUARIO_BY_ID(b))},[b,m]),B=e.useCallback(async()=>{try{j(!0);const e=await u(b);m(_.CHAT_CONVERSACION(e.id))}catch(e){}finally{j(!1)}},[b,m,u]);return a.jsxs(r,{sx:{mb:2,"&:hover":{boxShadow:3,transform:"translateY(-2px)",transition:"all 0.2s"}},children:[a.jsx(t,{children:a.jsxs(n,{direction:"row",spacing:2,alignItems:"flex-start",children:[a.jsx(i,{src:P,alt:`${y} ${v}`,sx:{width:60,height:60},children:!P&&a.jsx(f,{})}),a.jsxs(l,{sx:{flex:1},children:[a.jsxs(o,{variant:"h6",gutterBottom:!0,children:[y," ",v]}),a.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:C}),A.length>0&&a.jsxs(l,{sx:{mb:1},children:[a.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Puede enseñar:"}),a.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[A.slice(0,3).map((e,s)=>a.jsx(c,{label:e.nombre||e,size:"small",color:"primary",variant:"outlined",sx:{mt:.5}},s)),A.length>3&&a.jsx(c,{label:"+"+(A.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),z.length>0&&a.jsxs(l,{children:[a.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Quiere aprender:"}),a.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[z.slice(0,3).map((e,s)=>a.jsx(c,{label:e.nombre||e,size:"small",color:"secondary",variant:"outlined",sx:{mt:.5}},s)),z.length>3&&a.jsx(c,{label:"+"+(z.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]})]})]})}),a.jsxs(d,{sx:{justifyContent:"flex-end",px:2,pb:2},children:[a.jsx(x,{size:"small",onClick:R,children:"Ver Perfil"}),a.jsx(x,{variant:"contained",color:"primary",startIcon:p?a.jsx(h,{size:16,color:"inherit"}):a.jsx(g,{}),onClick:B,size:"small",disabled:p,children:p?"Abriendo...":"Chatear"})]})]})}),R=()=>{const{friends:s,loading:r,error:t}=(()=>{const[s,a]=e.useState([]),[r,t]=e.useState(!1),[n,i]=e.useState(null),l=e.useRef(!0),o=e.useCallback(async()=>{try{t(!0);const[e,s]=await Promise.all([v.get(C.USER),A()]),r=e.data.id,n=(await v.get(w.detalle(r))).data.matches||[];if(0===n.length)return l.current&&(a([]),i(null)),void t(!1);const o=(await Promise.all(n.map(async e=>{try{const a=(await v.get(w.detalle(e))).data;return{...a,habilidades_ofrecer:z(a.habilidades_que_se_saben,s),habilidades_aprender:z(a.habilidades_por_aprender,s)}}catch(a){return null}}))).filter(e=>null!==e);l.current&&(a(o),i(null))}catch(e){const s=e.response?.data?.message||"Error al cargar amigos";l.current&&i(s)}finally{l.current&&t(!1)}},[]);return e.useEffect(()=>(l.current=!0,o(),()=>{l.current=!1}),[o]),{friends:s,loading:r,error:n,fetchFriends:o}})(),{showToast:i}=S(),[c,d]=e.useState("");e.useEffect(()=>{t&&i(t,"error")},[t,i]);const x=s.filter(e=>{const s=c.toLowerCase(),a=`${e.nombre} ${e.apellido}`.toLowerCase(),r=(e.email||"").toLowerCase();return a.includes(s)||r.includes(s)});return r&&0===s.length?a.jsx(l,{sx:{display:"flex",justifyContent:"center",py:8},children:a.jsx(h,{})}):a.jsxs(m,{maxWidth:"md",sx:{py:4},children:[a.jsxs(n,{direction:"row",alignItems:"center",spacing:1,mb:3,children:[a.jsx(b,{sx:{fontSize:40,color:"primary.main"}}),a.jsxs(l,{children:[a.jsx(o,{variant:"h4",fontWeight:"bold",children:"Mis Amigos"}),a.jsxs(o,{variant:"body2",color:"text.secondary",children:[s.length," ",1===s.length?"amigo":"amigos"]})]})]}),s.length>0&&a.jsx(u,{fullWidth:!0,placeholder:"Buscar por nombre o email...",value:c,onChange:e=>d(e.target.value),sx:{mb:3},InputProps:{startAdornment:a.jsx(p,{position:"start",children:a.jsx(y,{})})}}),0===s.length?a.jsxs(j,{sx:{p:6,textAlign:"center"},children:[a.jsx(b,{sx:{fontSize:64,color:"text.secondary",mb:2}}),a.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aún no tienes amigos"}),a.jsx(o,{variant:"body2",color:"text.secondary",children:"Acepta solicitudes de match para empezar a conectar con otros usuarios"})]}):0===x.length?a.jsx(j,{sx:{p:4,textAlign:"center"},children:a.jsxs(o,{variant:"body1",color:"text.secondary",children:['No se encontraron amigos con "',c,'"']})}):a.jsx(l,{children:x.map(e=>a.jsx(P,{friend:e},e.id))})]})};export{R as default};
