import{r as e,j as t,B as n,T as r,k as i,d as a,C as o,m as s,A as l,p as c,q as d,G as u,n as h,R as p,u as g,t as f,v,w as m,s as b,I as x}from"./mui-core-CIRgtlGz.js";import{o as y,a as w,s as j,b as S,_ as C,n as E,l as R,c as D,C as k,u as I,F as A}from"./form-BGKyTMRe.js";import{a as M}from"./zod-C7KD4tJ8.js";import{U as _,A as T,c as N,H as O,T as z,b as L,C as P,R as q,V as B,a as F}from"../index-wLlOkRjP.js";import{u as W}from"./useErrorHandler-CGBV7vKC.js";import{b as U,c as H}from"./vendor-CoiQIOlL.js";import{u as V}from"./useMatchRequests-BQhWAKdb.js";import{E as Y,c as $,C as X,D as K,e as G,f as J,g as Q,h as Z,i as ee}from"./mui-icons-BQP8OJas.js";import"./http-Dos3PyFQ.js";import"./skillsCache-p9L68Yj9.js";const te=5242880,ne=["image/jpeg","image/jpg","image/png","image/webp"],re=y({nombre:j().min(1,"El nombre es obligatorio.").max(50,"El nombre es demasiado largo."),apellido:j().min(1,"El apellido es obligatorio.").max(50,"El apellido es demasiado largo."),telefono:j().max(16,"El teléfono es demasiado largo.").regex(/^\+?[0-9]*$/,"Formato de teléfono inválido.").optional().or(R("")),habilidades_que_se_saben:S(E().int().positive()).optional(),habilidades_por_aprender:S(E().int().positive()).optional(),email:j().email().optional(),media:w([j().url().optional(),C(FileList).refine(e=>0===e.length||e[0].size<=te,"El archivo no debe superar 5MB.").refine(e=>0===e.length||ne.includes(e[0].type),"Solo se aceptan imágenes JPG, PNG o WebP.").optional(),C(File).refine(e=>e.size<=te,"El archivo no debe superar 5MB.").refine(e=>ne.includes(e.type),"Solo se aceptan imágenes JPG, PNG o WebP.").optional()]).optional()});function ie(e){return e?{nombre:e.nombre||"",apellido:e.apellido||"",year:e.year||0,telefono:e.telefono||"",habilidades_que_se_saben:(e.habilidades_que_se_saben??[]).map(e=>"object"==typeof e?e.id:e),habilidades_por_aprender:(e.habilidades_por_aprender??[]).map(e=>"object"==typeof e?e.id:e),email:e.email||"",media:e.media||""}:null}const ae=({isOwnProfile:e,isEditing:s,onEdit:l,onSendMatchRequest:c,onAcceptRequest:d,onRejectRequest:u,onStartChat:h,onRemoveFriend:p,matchStatus:g,isSendingRequest:f,isStartingChat:v})=>t.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[t.jsx(r,{variant:"h4",component:"h1",sx:{mb:3,fontWeight:600},children:e?"Mi Perfil":"Perfil de Usuario"}),t.jsxs(i,{direction:"row",spacing:1,children:[e&&!s&&t.jsx(a,{variant:"outlined",startIcon:t.jsx(Y,{}),onClick:l,children:"Editar"}),!e&&t.jsx(t.Fragment,{children:"matched"===g?t.jsxs(i,{direction:"row",spacing:1,children:[t.jsx(a,{variant:"outlined",color:"success",startIcon:t.jsx($,{}),disabled:!0,children:"Son amigos"}),h&&t.jsx(a,{variant:"contained",color:"primary",startIcon:v?t.jsx(o,{size:20,color:"inherit"}):t.jsx(X,{}),onClick:h,disabled:v,children:v?"Abriendo...":"Enviar mensaje"}),p&&t.jsx(a,{variant:"outlined",color:"error",startIcon:t.jsx(K,{}),onClick:p,children:"Eliminar amigo"})]}):"pending"===g?t.jsx(a,{variant:"outlined",disabled:!0,children:"Solicitud enviada"}):"pending-received"===g?t.jsxs(i,{direction:"row",spacing:1,children:[t.jsx(a,{variant:"outlined",color:"error",onClick:u,disabled:f,children:"Rechazar"}),t.jsx(a,{variant:"contained",color:"success",startIcon:f?t.jsx(o,{size:20}):t.jsx($,{}),onClick:d,disabled:f,children:"Aceptar Solicitud"})]}):c&&t.jsx(a,{variant:"contained",color:"primary",startIcon:f?t.jsx(o,{size:20}):t.jsx(G,{}),onClick:c,disabled:f,children:"Enviar Solicitud"})})]})]}),oe=()=>t.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:t.jsx(o,{})}),se=({error:e,onLogout:n})=>t.jsxs(s,{maxWidth:"sm",sx:{mt:4},children:[t.jsx(l,{severity:"error",sx:{mb:2},children:e||"No se pudo cargar el perfil."}),t.jsx(a,{onClick:n,variant:"contained",children:"Volver a Iniciar Sesión"})]}),le=({profileData:o,isEditing:s})=>{const{register:l,formState:{errors:p},setValue:g,watch:f,trigger:v}=D(),[m,b]=e.useState(null);f("media"),encodeURIComponent(o?.nombre?.charAt(0)||"U");const x=m||o?.media;return t.jsx(c,{sx:{width:"100%"},children:t.jsxs(d,{children:[t.jsx(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:t.jsx(r,{variant:"h6",children:"Información Personal"})}),t.jsxs(n,{sx:{mt:2},children:[t.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(n,{sx:{position:"relative"},children:t.jsx(n,{sx:e=>({width:80,height:80,borderRadius:"50%",backgroundImage:x?`url(${x})`:"none",backgroundSize:"cover",backgroundPosition:"center",mr:2,border:`2px solid ${e.palette.divider}`,backgroundColor:x?"transparent":e.palette.action.hover}),children:!x&&t.jsx(n,{sx:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(J,{sx:{fontSize:50,color:"text.secondary"}})})})}),t.jsxs(n,{children:[t.jsxs(r,{variant:"h5",children:[o?.nombre," ",o?.apellido]}),t.jsx(r,{variant:"body2",color:"text.secondary",children:o?.email})]})]}),!s&&t.jsx(u,{container:!0,spacing:2,sx:{mt:1},children:t.jsx(u,{size:{xs:12,sm:6},children:t.jsxs(r,{variant:"body1",children:[t.jsx(r,{component:"span",sx:{fontWeight:"bold"},children:"Teléfono:"})," ",o?.telefono||"N/A"]})})}),s&&t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(h,{fullWidth:!0,label:"Nombre",...l("nombre"),error:!!p.nombre,helperText:p.nombre?.message})}),t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(h,{fullWidth:!0,label:"Apellido",...l("apellido"),error:!!p.apellido,helperText:p.apellido?.message})}),t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(h,{fullWidth:!0,label:"Teléfono",...l("telefono"),error:!!p.telefono,helperText:p.telefono?.message})}),t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(h,{fullWidth:!0,label:"Email (Solo Lectura)",value:o?.email||"",InputProps:{readOnly:!0}})}),t.jsxs(u,{size:{xs:12},children:[t.jsx(r,{variant:"subtitle2",sx:{mb:1},children:"Foto de Perfil"}),t.jsx(i,{direction:"row",spacing:1,alignItems:"center",children:t.jsxs(a,{variant:"outlined",component:"label",startIcon:t.jsx(Q,{}),size:"small",children:["Subir Imagen",t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{const t=e.target.files?.[0];if(t){const n=new FileReader;n.onloadend=()=>{b(n.result)},n.readAsDataURL(t),g("media",e.target.files,{shouldDirty:!0,shouldValidate:!0})}}})]})}),p.media&&t.jsx(r,{color:"error",variant:"caption",sx:{mt:1,display:"block"},children:p.media.message})]})]})]})]})})};const ce="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function de(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function ue(e){return"nodeType"in e}function he(e){var t,n;return e?de(e)?e:ue(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function pe(e){const{Document:t}=he(e);return e instanceof t}function ge(e){return!de(e)&&e instanceof he(e).HTMLElement}function fe(e){return e instanceof he(e).SVGElement}function ve(e){return e?de(e)?e.document:ue(e)?pe(e)?e:ge(e)||fe(e)?e.ownerDocument:document:document:document}const me=ce?e.useLayoutEffect:e.useEffect;function be(t){const n=e.useRef(t);return me(()=>{n.current=t}),e.useCallback(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function xe(t,n){void 0===n&&(n=[t]);const r=e.useRef(t);return me(()=>{r.current!==t&&(r.current=t)},n),r}function ye(t,n){const r=e.useRef();return e.useMemo(()=>{const e=t(r.current);return r.current=e,e},[...n])}function we(t){const n=be(t),r=e.useRef(null),i=e.useCallback(e=>{e!==r.current&&(null==n||n(e,r.current)),r.current=e},[]);return[r,i]}function je(t){const n=e.useRef();return e.useEffect(()=>{n.current=t},[t]),n.current}let Se={};function Ce(t,n){return e.useMemo(()=>{if(n)return n;const e=null==Se[t]?0:Se[t]+1;return Se[t]=e,t+"-"+e},[t,n])}function Ee(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((t,n)=>{const r=Object.entries(n);for(const[i,a]of r){const n=t[i];null!=n&&(t[i]=n+e*a)}return t},{...t})}}const Re=Ee(1),De=Ee(-1);function ke(e){if(!e)return!1;const{KeyboardEvent:t}=he(e.target);return t&&e instanceof t}function Ie(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=he(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const Ae=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Ae.Translate.toString(e),Ae.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Me="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function _e(e){return e.matches(Me)?e:e.querySelector(Me)}const Te={display:"none"};function Ne(e){let{id:t,value:n}=e;return p.createElement("div",{id:t,style:Te},n)}function Oe(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return p.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}const ze=e.createContext(null);const Le={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Pe={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function qe(t){let{announcements:n=Pe,container:r,hiddenTextDescribedById:i,screenReaderInstructions:a=Le}=t;const{announce:o,announcement:s}=function(){const[t,n]=e.useState("");return{announce:e.useCallback(e=>{null!=e&&n(e)},[]),announcement:t}}(),l=Ce("DndLiveRegion"),[c,d]=e.useState(!1);if(e.useEffect(()=>{d(!0)},[]),function(t){const n=e.useContext(ze);e.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(t)},[t,n])}(e.useMemo(()=>({onDragStart(e){let{active:t}=e;o(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&o(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;o(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;o(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;o(n.onDragCancel({active:t,over:r}))}}),[o,n])),!c)return null;const u=p.createElement(p.Fragment,null,p.createElement(Ne,{id:i,value:a.draggable}),p.createElement(Oe,{id:l,announcement:s}));return r?g.createPortal(u,r):u}var Be,Fe;function We(){}(Fe=Be||(Be={})).DragStart="dragStart",Fe.DragMove="dragMove",Fe.DragEnd="dragEnd",Fe.DragCancel="dragCancel",Fe.DragOver="dragOver",Fe.RegisterDroppable="registerDroppable",Fe.SetDroppableDisabled="setDroppableDisabled",Fe.UnregisterDroppable="unregisterDroppable";const Ue=Object.freeze({x:0,y:0});function He(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ve(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Ye(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function $e(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}const Xe=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=$e(t,t.left,t.top),a=[];for(const o of r){const{id:e}=o,t=n.get(e);if(t){const n=He($e(t),i);a.push({id:e,data:{droppableContainer:o,value:n}})}}return a.sort(Ve)};function Ke(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height),o=i-r,s=a-n;if(r<i&&n<a){const n=t.width*t.height,r=e.width*e.height,i=o*s;return Number((i/(n+r-i)).toFixed(4))}return 0}const Ge=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const i=[];for(const a of r){const{id:e}=a,r=n.get(e);if(r){const n=Ke(r,t);n>0&&i.push({id:e,data:{droppableContainer:a,value:n}})}}return i.sort(Ye)};function Je(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Ue}function Qe(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}const Ze=Qe(1);const et={ignoreTransform:!1};function tt(e,t){void 0===t&&(t=et);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=he(e).getComputedStyle(e);t&&(n=function(e,t,n){const r=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!r)return e;const{scaleX:i,scaleY:a,x:o,y:s}=r,l=e.left-o-(1-i)*parseFloat(n),c=e.top-s-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),d=i?e.width/i:e.width,u=a?e.height/a:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(n,t,r))}const{top:r,left:i,width:a,height:o,bottom:s,right:l}=n;return{top:r,left:i,width:a,height:o,bottom:s,right:l}}function nt(e){return tt(e,{ignoreTransform:!0})}function rt(e,t){const n=[];return e?function r(i){if(null!=t&&n.length>=t)return n;if(!i)return n;if(pe(i)&&null!=i.scrollingElement&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!ge(i)||fe(i))return n;if(n.includes(i))return n;const a=he(e).getComputedStyle(i);return i!==e&&function(e,t){void 0===t&&(t=he(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&n.test(r)})}(i,a)&&n.push(i),function(e,t){return void 0===t&&(t=he(e).getComputedStyle(e)),"fixed"===t.position}(i,a)?n:r(i.parentNode)}(e):n}function it(e){const[t]=rt(e,1);return null!=t?t:null}function at(e){return ce&&e?de(e)?e:ue(e)?pe(e)||e===ve(e).scrollingElement?window:ge(e)?e:null:null:null}function ot(e){return de(e)?e.scrollX:e.scrollLeft}function st(e){return de(e)?e.scrollY:e.scrollTop}function lt(e){return{x:ot(e),y:st(e)}}var ct,dt;function ut(e){return!(!ce||!e)&&e===document.scrollingElement}function ht(e){const t={x:0,y:0},n=ut(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(dt=ct||(ct={}))[dt.Forward=1]="Forward",dt[dt.Backward=-1]="Backward";const pt={x:.2,y:.2};function gt(e,t,n,r,i){let{top:a,left:o,right:s,bottom:l}=n;void 0===r&&(r=10),void 0===i&&(i=pt);const{isTop:c,isBottom:d,isLeft:u,isRight:h}=ht(e),p={x:0,y:0},g={x:0,y:0},f=t.height*i.y,v=t.width*i.x;return!c&&a<=t.top+f?(p.y=ct.Backward,g.y=r*Math.abs((t.top+f-a)/f)):!d&&l>=t.bottom-f&&(p.y=ct.Forward,g.y=r*Math.abs((t.bottom-f-l)/f)),!h&&s>=t.right-v?(p.x=ct.Forward,g.x=r*Math.abs((t.right-v-s)/v)):!u&&o<=t.left+v&&(p.x=ct.Backward,g.x=r*Math.abs((t.left+v-o)/v)),{direction:p,speed:g}}function ft(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:n,right:r,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:i,width:e.clientWidth,height:e.clientHeight}}function vt(e){return e.reduce((e,t)=>Re(e,lt(t)),Ue)}const mt=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+ot(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+st(t),0)}]];class bt{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=rt(t),r=vt(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,a,o]of mt)for(const e of a)Object.defineProperty(this,e,{get:()=>{const t=o(n),a=r[i]-t;return this.rect[e]+a},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class xt{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function yt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}var wt,jt,St,Ct;function Et(e){e.preventDefault()}function Rt(e){e.stopPropagation()}(jt=wt||(wt={})).Click="click",jt.DragStart="dragstart",jt.Keydown="keydown",jt.ContextMenu="contextmenu",jt.Resize="resize",jt.SelectionChange="selectionchange",jt.VisibilityChange="visibilitychange",(Ct=St||(St={})).Space="Space",Ct.Down="ArrowDown",Ct.Right="ArrowRight",Ct.Left="ArrowLeft",Ct.Up="ArrowUp",Ct.Esc="Escape",Ct.Enter="Enter",Ct.Tab="Tab";const Dt={start:[St.Space,St.Enter],cancel:[St.Esc],end:[St.Space,St.Enter,St.Tab]},kt=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case St.Right:return{...n,x:n.x+25};case St.Left:return{...n,x:n.x-25};case St.Down:return{...n,y:n.y+25};case St.Up:return{...n,y:n.y-25}}};class It{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new xt(ve(t)),this.windowListeners=new xt(he(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(wt.Resize,this.handleCancel),this.windowListeners.add(wt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(wt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&function(e,t){if(void 0===t&&(t=tt),!e)return;const{top:n,left:r,bottom:i,right:a}=t(e);it(e)&&(i<=0||a<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(n),t(Ue)}handleKeyDown(e){if(ke(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:i=Dt,coordinateGetter:a=kt,scrollBehavior:o="smooth"}=r,{code:s}=e;if(i.end.includes(s))return void this.handleEnd(e);if(i.cancel.includes(s))return void this.handleCancel(e);const{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:Ue;this.referenceCoordinates||(this.referenceCoordinates=c);const d=a(e,{active:t,context:n.current,currentCoordinates:c});if(d){const t=De(d,c),r={x:0,y:0},{scrollableAncestors:i}=n.current;for(const n of i){const i=e.code,{isTop:a,isRight:s,isLeft:l,isBottom:c,maxScroll:u,minScroll:h}=ht(n),p=ft(n),g={x:Math.min(i===St.Right?p.right-p.width/2:p.right,Math.max(i===St.Right?p.left:p.left+p.width/2,d.x)),y:Math.min(i===St.Down?p.bottom-p.height/2:p.bottom,Math.max(i===St.Down?p.top:p.top+p.height/2,d.y))},f=i===St.Right&&!s||i===St.Left&&!l,v=i===St.Down&&!c||i===St.Up&&!a;if(f&&g.x!==d.x){const e=n.scrollLeft+t.x,a=i===St.Right&&e<=u.x||i===St.Left&&e>=h.x;if(a&&!t.y)return void n.scrollTo({left:e,behavior:o});r.x=a?n.scrollLeft-e:i===St.Right?n.scrollLeft-u.x:n.scrollLeft-h.x,r.x&&n.scrollBy({left:-r.x,behavior:o});break}if(v&&g.y!==d.y){const e=n.scrollTop+t.y,a=i===St.Down&&e<=u.y||i===St.Up&&e>=h.y;if(a&&!t.x)return void n.scrollTo({top:e,behavior:o});r.y=a?n.scrollTop-e:i===St.Down?n.scrollTop-u.y:n.scrollTop-h.y,r.y&&n.scrollBy({top:-r.y,behavior:o});break}}this.handleMove(e,Re(De(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function At(e){return Boolean(e&&"distance"in e)}function Mt(e){return Boolean(e&&"delay"in e)}It.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Dt,onActivation:i}=t,{active:a}=n;const{code:o}=e.nativeEvent;if(r.start.includes(o)){const t=a.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==i||i({event:e.nativeEvent}),!0)}return!1}}];class _t{constructor(e,t,n){var r;void 0===n&&(n=function(e){const{EventTarget:t}=he(e);return e instanceof t?e:ve(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:a}=i;this.props=e,this.events=t,this.document=ve(a),this.documentListeners=new xt(this.document),this.listeners=new xt(n),this.windowListeners=new xt(he(a)),this.initialCoordinates=null!=(r=Ie(i))?r:Ue,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(wt.Resize,this.handleCancel),this.windowListeners.add(wt.DragStart,Et),this.windowListeners.add(wt.VisibilityChange,this.handleCancel),this.windowListeners.add(wt.ContextMenu,Et),this.documentListeners.add(wt.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Mt(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(At(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(wt.Click,Rt,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(wt.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:i}=this,{onMove:a,options:{activationConstraint:o}}=i;if(!r)return;const s=null!=(t=Ie(e))?t:Ue,l=De(r,s);if(!n&&o){if(At(o)){if(null!=o.tolerance&&yt(l,o.tolerance))return this.handleCancel();if(yt(l,o.distance))return this.handleStart()}return Mt(o)&&yt(l,o.tolerance)?this.handleCancel():void this.handlePending(o,l)}e.cancelable&&e.preventDefault(),a(s)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===St.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const Tt={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Nt extends _t{constructor(e){const{event:t}=e,n=ve(t.target);super(e,Tt,n)}}Nt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!(!n.isPrimary||0!==n.button)&&(null==r||r({event:n}),!0)}}];const Ot={move:{name:"mousemove"},end:{name:"mouseup"}};var zt,Lt;(Lt=zt||(zt={}))[Lt.RightClick=2]="RightClick";(class extends _t{constructor(e){super(e,Ot,ve(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button!==zt.RightClick&&(null==r||r({event:n}),!0)}}];const Pt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var qt,Bt,Ft,Wt;function Ut(t){let{acceleration:n,activator:r=qt.Pointer,canScroll:i,draggingRect:a,enabled:o,interval:s=5,order:l=Ft.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:h,threshold:p}=t;const g=function(e){let{delta:t,disabled:n}=e;const r=je(t);return ye(e=>{if(n||!r||!e)return Ht;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[ct.Backward]:e.x[ct.Backward]||-1===i.x,[ct.Forward]:e.x[ct.Forward]||1===i.x},y:{[ct.Backward]:e.y[ct.Backward]||-1===i.y,[ct.Forward]:e.y[ct.Forward]||1===i.y}}},[n,t,r])}({delta:h,disabled:!o}),[f,v]=function(){const t=e.useRef(null);return[e.useCallback((e,n)=>{t.current=setInterval(e,n)},[]),e.useCallback(()=>{null!==t.current&&(clearInterval(t.current),t.current=null)},[])]}(),m=e.useRef({x:0,y:0}),b=e.useRef({x:0,y:0}),x=e.useMemo(()=>{switch(r){case qt.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case qt.DraggableRect:return a}},[r,a,c]),y=e.useRef(null),w=e.useCallback(()=>{const e=y.current;if(!e)return;const t=m.current.x*b.current.x,n=m.current.y*b.current.y;e.scrollBy(t,n)},[]),j=e.useMemo(()=>l===Ft.TreeOrder?[...d].reverse():d,[l,d]);e.useEffect(()=>{if(o&&d.length&&x){for(const e of j){if(!1===(null==i?void 0:i(e)))continue;const t=d.indexOf(e),r=u[t];if(!r)continue;const{direction:a,speed:o}=gt(e,r,x,n,p);for(const e of["x","y"])g[e][a[e]]||(o[e]=0,a[e]=0);if(o.x>0||o.y>0)return v(),y.current=e,f(w,s),m.current=o,void(b.current=a)}m.current={x:0,y:0},b.current={x:0,y:0},v()}else v()},[n,w,i,v,o,s,JSON.stringify(x),JSON.stringify(g),f,d,j,u,JSON.stringify(p)])}(class extends _t{constructor(e){super(e,Pt)}static setup(){return window.addEventListener(Pt.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Pt.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:i}=n;return!(i.length>1)&&(null==r||r({event:n}),!0)}}],(Bt=qt||(qt={}))[Bt.Pointer=0]="Pointer",Bt[Bt.DraggableRect=1]="DraggableRect",(Wt=Ft||(Ft={}))[Wt.TreeOrder=0]="TreeOrder",Wt[Wt.ReversedTreeOrder=1]="ReversedTreeOrder";const Ht={x:{[ct.Backward]:!1,[ct.Forward]:!1},y:{[ct.Backward]:!1,[ct.Forward]:!1}};var Vt,Yt,$t;(Yt=Vt||(Vt={}))[Yt.Always=0]="Always",Yt[Yt.BeforeDragging=1]="BeforeDragging",Yt[Yt.WhileDragging=2]="WhileDragging",($t||($t={})).Optimized="optimized";const Xt=new Map;function Kt(e,t){return ye(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function Gt(t){let{callback:n,disabled:r}=t;const i=be(n),a=e.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(i)},[r]);return e.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}function Jt(e){return new bt(tt(e),e)}function Qt(t,n,r){void 0===n&&(n=Jt);const[i,a]=e.useState(null);function o(){a(e=>{if(!t)return null;var i;if(!1===t.isConnected)return null!=(i=null!=e?e:r)?i:null;const a=n(t);return JSON.stringify(e)===JSON.stringify(a)?e:a})}const s=function(t){let{callback:n,disabled:r}=t;const i=be(n),a=e.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(i)},[i,r]);return e.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}({callback(e){if(t)for(const n of e){const{type:e,target:r}=n;if("childList"===e&&r instanceof HTMLElement&&r.contains(t)){o();break}}}}),l=Gt({callback:o});return me(()=>{o(),t?(null==l||l.observe(t),null==s||s.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==s||s.disconnect())},[t]),i}const Zt=[];function en(t,n){void 0===n&&(n=[]);const r=e.useRef(null);return e.useEffect(()=>{r.current=null},n),e.useEffect(()=>{const e=t!==Ue;e&&!r.current&&(r.current=t),!e&&r.current&&(r.current=null)},[t]),r.current?De(t,r.current):Ue}function tn(t){return e.useMemo(()=>t?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(t):null,[t])}const nn=[];function rn(t){let{measure:n}=t;const[r,i]=e.useState(null),a=Gt({callback:e.useCallback(e=>{for(const{target:t}of e)if(ge(t)){i(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),o=e.useCallback(e=>{const t=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return ge(t)?t:e}(e);null==a||a.disconnect(),t&&(null==a||a.observe(t)),i(t?n(t):null)},[n,a]),[s,l]=we(o);return e.useMemo(()=>({nodeRef:s,rect:r,setRef:l}),[r,s,l])}const an=[{sensor:Nt,options:{}},{sensor:It,options:{}}],on={current:{}},sn={draggable:{measure:nt},droppable:{measure:nt,strategy:Vt.WhileDragging,frequency:$t.Optimized},dragOverlay:{measure:tt}};class ln extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}const cn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ln,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:We},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:sn,measureDroppableContainers:We,windowRect:null,measuringScheduled:!1},dn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:We,draggableNodes:new Map,over:null,measureDroppableContainers:We},un=e.createContext(dn),hn=e.createContext(cn);function pn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ln}}}function gn(e,t){switch(t.type){case Be.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Be.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Be.DragEnd:case Be.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Be.RegisterDroppable:{const{element:n}=t,{id:r}=n,i=new ln(e.droppable.containers);return i.set(r,n),{...e,droppable:{...e.droppable,containers:i}}}case Be.SetDroppableDisabled:{const{id:n,key:r,disabled:i}=t,a=e.droppable.containers.get(n);if(!a||r!==a.key)return e;const o=new ln(e.droppable.containers);return o.set(n,{...a,disabled:i}),{...e,droppable:{...e.droppable,containers:o}}}case Be.UnregisterDroppable:{const{id:n,key:r}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const a=new ln(e.droppable.containers);return a.delete(n),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function fn(t){let{disabled:n}=t;const{active:r,activatorEvent:i,draggableNodes:a}=e.useContext(un),o=je(i),s=je(null==r?void 0:r.id);return e.useEffect(()=>{if(!n&&!i&&o&&null!=s){if(!ke(o))return;if(document.activeElement===o.target)return;const e=a.get(s);if(!e)return;const{activatorNode:t,node:n}=e;if(!t.current&&!n.current)return;requestAnimationFrame(()=>{for(const e of[t.current,n.current]){if(!e)continue;const t=_e(e);if(t){t.focus();break}}})}},[i,n,a,s,o]),null}const vn=e.createContext({...Ue,scaleX:1,scaleY:1});var mn,bn;(bn=mn||(mn={}))[bn.Uninitialized=0]="Uninitialized",bn[bn.Initializing=1]="Initializing",bn[bn.Initialized=2]="Initialized";const xn=e.memo(function(t){var n,r,i,a;let{id:o,accessibility:s,autoScroll:l=!0,children:c,sensors:d=an,collisionDetection:u=Ge,measuring:h,modifiers:f,...v}=t;const m=e.useReducer(gn,void 0,pn),[b,x]=m,[y,w]=function(){const[t]=e.useState(()=>new Set),n=e.useCallback(e=>(t.add(e),()=>t.delete(e)),[t]);return[e.useCallback(e=>{let{type:n,event:r}=e;t.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[t]),n]}(),[j,S]=e.useState(mn.Uninitialized),C=j===mn.Initialized,{draggable:{active:E,nodes:R,translate:D},droppable:{containers:k}}=b,I=null!=E?R.get(E):null,A=e.useRef({initial:null,translated:null}),M=e.useMemo(()=>{var e;return null!=E?{id:E,data:null!=(e=null==I?void 0:I.data)?e:on,rect:A}:null},[E,I]),_=e.useRef(null),[T,N]=e.useState(null),[O,z]=e.useState(null),L=xe(v,Object.values(v)),P=Ce("DndDescribedBy",o),q=e.useMemo(()=>k.getEnabled(),[k]),B=(F=h,e.useMemo(()=>({draggable:{...sn.draggable,...null==F?void 0:F.draggable},droppable:{...sn.droppable,...null==F?void 0:F.droppable},dragOverlay:{...sn.dragOverlay,...null==F?void 0:F.dragOverlay}}),[null==F?void 0:F.draggable,null==F?void 0:F.droppable,null==F?void 0:F.dragOverlay]));var F;const{droppableRects:W,measureDroppableContainers:U,measuringScheduled:H}=function(t,n){let{dragging:r,dependencies:i,config:a}=n;const[o,s]=e.useState(null),{frequency:l,measure:c,strategy:d}=a,u=e.useRef(t),h=function(){switch(d){case Vt.Always:return!1;case Vt.BeforeDragging:return r;default:return!r}}(),p=xe(h),g=e.useCallback(function(e){void 0===e&&(e=[]),p.current||s(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[p]),f=e.useRef(null),v=ye(e=>{if(h&&!r)return Xt;if(!e||e===Xt||u.current!==t||null!=o){const e=new Map;for(let n of t){if(!n)continue;if(o&&o.length>0&&!o.includes(n.id)&&n.rect.current){e.set(n.id,n.rect.current);continue}const t=n.node.current,r=t?new bt(c(t),t):null;n.rect.current=r,r&&e.set(n.id,r)}return e}return e},[t,o,r,h,c]);return e.useEffect(()=>{u.current=t},[t]),e.useEffect(()=>{h||g()},[r,h]),e.useEffect(()=>{o&&o.length>0&&s(null)},[JSON.stringify(o)]),e.useEffect(()=>{h||"number"!=typeof l||null!==f.current||(f.current=setTimeout(()=>{g(),f.current=null},l))},[l,h,g,...i]),{droppableRects:v,measureDroppableContainers:g,measuringScheduled:null!=o}}(q,{dragging:C,dependencies:[D.x,D.y],config:B.droppable}),V=function(e,t){const n=null!=t?e.get(t):void 0,r=n?n.node.current:null;return ye(e=>{var n;return null==t?null:null!=(n=null!=r?r:e)?n:null},[r,t])}(R,E),Y=e.useMemo(()=>O?Ie(O):null,[O]),$=function(){const e=!1===(null==T?void 0:T.autoScrollEnabled),t="object"==typeof l?!1===l.enabled:!1===l,n=C&&!e&&!t;if("object"==typeof l)return{...l,enabled:n};return{enabled:n}}(),X=function(e,t){return Kt(e,t)}(V,B.draggable.measure);!function(t){let{activeNode:n,measure:r,initialRect:i,config:a=!0}=t;const o=e.useRef(!1),{x:s,y:l}="boolean"==typeof a?{x:a,y:a}:a;me(()=>{if(!s&&!l||!n)return void(o.current=!1);if(o.current||!i)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const t=Je(r(e),i);if(s||(t.x=0),l||(t.y=0),o.current=!0,Math.abs(t.x)>0||Math.abs(t.y)>0){const n=it(e);n&&n.scrollBy({top:t.y,left:t.x})}},[n,s,l,i,r])}({activeNode:null!=E?R.get(E):null,config:$.layoutShiftCompensation,initialRect:X,measure:B.draggable.measure});const K=Qt(V,B.draggable.measure,X),G=Qt(V?V.parentElement:null),J=e.useRef({activatorEvent:null,active:null,activeNode:V,collisionRect:null,collisions:null,droppableRects:W,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:k,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=k.getNodeFor(null==(n=J.current.over)?void 0:n.id),Z=rn({measure:B.dragOverlay.measure}),ee=null!=(r=Z.nodeRef.current)?r:V,te=C?null!=(i=Z.rect)?i:K:null,ne=Boolean(Z.nodeRef.current&&Z.rect),re=Je(ie=ne?null:K,Kt(ie));var ie;const ae=tn(ee?he(ee):null),oe=function(t){const n=e.useRef(t),r=ye(e=>t?e&&e!==Zt&&t&&n.current&&t.parentNode===n.current.parentNode?e:rt(t):Zt,[t]);return e.useEffect(()=>{n.current=t},[t]),r}(C?null!=Q?Q:V:null),se=function(t,n){void 0===n&&(n=tt);const[r]=t,i=tn(r?he(r):null),[a,o]=e.useState(nn);function s(){o(()=>t.length?t.map(e=>ut(e)?i:new bt(n(e),e)):nn)}const l=Gt({callback:s});return me(()=>{null==l||l.disconnect(),s(),t.forEach(e=>null==l?void 0:l.observe(e))},[t]),a}(oe),le=function(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}(f,{transform:{x:D.x-re.x,y:D.y-re.y,scaleX:1,scaleY:1},activatorEvent:O,active:M,activeNodeRect:K,containerNodeRect:G,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Z.rect,scrollableAncestors:oe,scrollableAncestorRects:se,windowRect:ae}),de=Y?Re(Y,D):null,ue=function(t){const[n,r]=e.useState(null),i=e.useRef(t),a=e.useCallback(e=>{const t=at(e.target);t&&r(e=>e?(e.set(t,lt(t)),new Map(e)):null)},[]);return e.useEffect(()=>{const e=i.current;if(t!==e){n(e);const o=t.map(e=>{const t=at(e);return t?(t.addEventListener("scroll",a,{passive:!0}),[t,lt(t)]):null}).filter(e=>null!=e);r(o.length?new Map(o):null),i.current=t}return()=>{n(t),n(e)};function n(e){e.forEach(e=>{const t=at(e);null==t||t.removeEventListener("scroll",a)})}},[a,t]),e.useMemo(()=>t.length?n?Array.from(n.values()).reduce((e,t)=>Re(e,t),Ue):vt(t):Ue,[t,n])}(oe),pe=en(ue),ge=en(ue,[K]),fe=Re(le,pe),ve=te?Ze(te,le):null,be=M&&ve?u({active:M,collisionRect:ve,droppableRects:W,droppableContainers:q,pointerCoordinates:de}):null,we=function(e,t){if(!e||0===e.length)return null;const[n]=e;return n[t]}(be,"id"),[je,Se]=e.useState(null),Ee=function(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}(ne?le:Re(le,ge),null!=(a=null==je?void 0:je.rect)?a:null,K),De=e.useRef(null),ke=e.useCallback((e,t)=>{let{sensor:n,options:r}=t;if(null==_.current)return;const i=R.get(_.current);if(!i)return;const a=e.nativeEvent,o=new n({active:_.current,activeNode:i,event:a,options:r,context:J,onAbort(e){if(!R.get(e))return;const{onDragAbort:t}=L.current,n={id:e};null==t||t(n),y({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!R.get(e))return;const{onDragPending:i}=L.current,a={id:e,constraint:t,initialCoordinates:n,offset:r};null==i||i(a),y({type:"onDragPending",event:a})},onStart(e){const t=_.current;if(null==t)return;const n=R.get(t);if(!n)return;const{onDragStart:r}=L.current,i={activatorEvent:a,active:{id:t,data:n.data,rect:A}};g.unstable_batchedUpdates(()=>{null==r||r(i),S(mn.Initializing),x({type:Be.DragStart,initialCoordinates:e,active:t}),y({type:"onDragStart",event:i}),N(De.current),z(a)})},onMove(e){x({type:Be.DragMove,coordinates:e})},onEnd:s(Be.DragEnd),onCancel:s(Be.DragCancel)});function s(e){return async function(){const{active:t,collisions:n,over:r,scrollAdjustedTranslate:i}=J.current;let o=null;if(t&&i){const{cancelDrop:s}=L.current;if(o={activatorEvent:a,active:t,collisions:n,delta:i,over:r},e===Be.DragEnd&&"function"==typeof s){await Promise.resolve(s(o))&&(e=Be.DragCancel)}}_.current=null,g.unstable_batchedUpdates(()=>{x({type:e}),S(mn.Uninitialized),Se(null),N(null),z(null),De.current=null;const t=e===Be.DragEnd?"onDragEnd":"onDragCancel";if(o){const e=L.current[t];null==e||e(o),y({type:t,event:o})}})}}De.current=o},[R]),Ae=function(t,n){return e.useMemo(()=>t.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[t,n])}(d,e.useCallback((e,t)=>(n,r)=>{const i=n.nativeEvent,a=R.get(r);if(null!==_.current||!a||i.dndKit||i.defaultPrevented)return;const o={active:a};!0===e(n,t.options,o)&&(i.dndKit={capturedBy:t.sensor},_.current=r,ke(n,t))},[R,ke]));!function(t){e.useEffect(()=>{if(!ce)return;const e=t.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const t of e)null==t||t()}},t.map(e=>{let{sensor:t}=e;return t}))}(d),me(()=>{K&&j===mn.Initializing&&S(mn.Initialized)},[K,j]),e.useEffect(()=>{const{onDragMove:e}=L.current,{active:t,activatorEvent:n,collisions:r,over:i}=J.current;if(!t||!n)return;const a={active:t,activatorEvent:n,collisions:r,delta:{x:fe.x,y:fe.y},over:i};g.unstable_batchedUpdates(()=>{null==e||e(a),y({type:"onDragMove",event:a})})},[fe.x,fe.y]),e.useEffect(()=>{const{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:i}=J.current;if(!e||null==_.current||!t||!i)return;const{onDragOver:a}=L.current,o=r.get(we),s=o&&o.rect.current?{id:o.id,rect:o.rect.current,data:o.data,disabled:o.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:i.x,y:i.y},over:s};g.unstable_batchedUpdates(()=>{Se(s),null==a||a(l),y({type:"onDragOver",event:l})})},[we]),me(()=>{J.current={activatorEvent:O,active:M,activeNode:V,collisionRect:ve,collisions:be,droppableRects:W,draggableNodes:R,draggingNode:ee,draggingNodeRect:te,droppableContainers:k,over:je,scrollableAncestors:oe,scrollAdjustedTranslate:fe},A.current={initial:te,translated:ve}},[M,V,be,ve,R,ee,te,W,k,je,oe,fe]),Ut({...$,delta:D,draggingRect:ve,pointerCoordinates:de,scrollableAncestors:oe,scrollableAncestorRects:se});const Me=e.useMemo(()=>({active:M,activeNode:V,activeNodeRect:K,activatorEvent:O,collisions:be,containerNodeRect:G,dragOverlay:Z,draggableNodes:R,droppableContainers:k,droppableRects:W,over:je,measureDroppableContainers:U,scrollableAncestors:oe,scrollableAncestorRects:se,measuringConfiguration:B,measuringScheduled:H,windowRect:ae}),[M,V,K,O,be,G,Z,R,k,W,je,U,oe,se,B,H,ae]),_e=e.useMemo(()=>({activatorEvent:O,activators:Ae,active:M,activeNodeRect:K,ariaDescribedById:{draggable:P},dispatch:x,draggableNodes:R,over:je,measureDroppableContainers:U}),[O,Ae,M,K,x,P,R,je,U]);return p.createElement(ze.Provider,{value:w},p.createElement(un.Provider,{value:_e},p.createElement(hn.Provider,{value:Me},p.createElement(vn.Provider,{value:Ee},c)),p.createElement(fn,{disabled:!1===(null==s?void 0:s.restoreFocus)})),p.createElement(qe,{...s,hiddenTextDescribedById:P}))}),yn=e.createContext(null),wn="button";function jn(t){let{id:n,data:r,disabled:i=!1,attributes:a}=t;const o=Ce("Draggable"),{activators:s,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:h,over:p}=e.useContext(un),{role:g=wn,roleDescription:f="draggable",tabIndex:v=0}=null!=a?a:{},m=(null==c?void 0:c.id)===n,b=e.useContext(m?vn:yn),[x,y]=we(),[w,j]=we(),S=function(t,n){return e.useMemo(()=>t.reduce((e,t)=>{let{eventName:r,handler:i}=t;return e[r]=e=>{i(e,n)},e},{}),[t,n])}(s,n),C=xe(r);me(()=>(h.set(n,{id:n,key:o,node:x,activatorNode:w,data:C}),()=>{const e=h.get(n);e&&e.key===o&&h.delete(n)}),[h,n]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:e.useMemo(()=>({role:g,tabIndex:v,"aria-disabled":i,"aria-pressed":!(!m||g!==wn)||void 0,"aria-roledescription":f,"aria-describedby":u.draggable}),[i,g,v,m,f,u.draggable]),isDragging:m,listeners:i?void 0:S,node:x,over:p,setNodeRef:y,setActivatorNodeRef:j,transform:b}}const Sn={timeout:25};function Cn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function En(e,t){return e.reduce((e,n,r)=>{const i=t.get(n);return i&&(e[r]=i),e},Array(e.length))}function Rn(e){return null!==e&&e>=0}const Dn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:i}=e;const a=Cn(t,r,n),o=t[i],s=a[i];return s&&o?{x:s.left-o.left,y:s.top-o.top,scaleX:s.width/o.width,scaleY:s.height/o.height}:null},kn={scaleX:1,scaleY:1},In=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:i,rects:a,overIndex:o}=e;const s=null!=(t=a[n])?t:r;if(!s)return null;if(i===n){const e=a[o];return e?{x:0,y:n<o?e.top+e.height-(s.top+s.height):e.top-s.top,...kn}:null}const l=function(e,t,n){const r=e[t],i=e[t-1],a=e[t+1];if(!r)return 0;if(n<t)return i?r.top-(i.top+i.height):a?a.top-(r.top+r.height):0;return a?a.top-(r.top+r.height):i?r.top-(i.top+i.height):0}(a,i,n);return i>n&&i<=o?{x:0,y:-s.height-l,...kn}:i<n&&i>=o?{x:0,y:s.height+l,...kn}:{x:0,y:0,...kn}};const An="Sortable",Mn=p.createContext({activeIndex:-1,containerId:An,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Dn,disabled:{draggable:!1,droppable:!1}});function _n(t){let{children:n,id:r,items:i,strategy:a=Dn,disabled:o=!1}=t;const{active:s,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=e.useContext(hn),h=Ce(An,r),g=Boolean(null!==l.rect),f=e.useMemo(()=>i.map(e=>"object"==typeof e&&"id"in e?e.id:e),[i]),v=null!=s,m=s?f.indexOf(s.id):-1,b=d?f.indexOf(d.id):-1,x=e.useRef(f),y=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(f,x.current),w=-1!==b&&-1===m||y,j=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(o);me(()=>{y&&v&&u(f)},[y,f,v,u]),e.useEffect(()=>{x.current=f},[f]);const S=e.useMemo(()=>({activeIndex:m,containerId:h,disabled:j,disableTransforms:w,items:f,overIndex:b,useDragOverlay:g,sortedRects:En(f,c),strategy:a}),[m,h,j.draggable,j.droppable,w,f,b,c,g,a]);return p.createElement(Mn.Provider,{value:S},n)}const Tn=e=>{let{id:t,items:n,activeIndex:r,overIndex:i}=e;return Cn(n,r,i).indexOf(t)},Nn=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:i,items:a,newIndex:o,previousItems:s,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((s===a||i!==o)&&(!!n||o!==i&&t===l))},On={duration:200,easing:"ease"},zn="transform",Ln=Ae.Transition.toString({property:zn,duration:0,easing:"linear"}),Pn={roleDescription:"sortable"};function qn(t){let{animateLayoutChanges:n=Nn,attributes:r,disabled:i,data:a,getNewIndex:o=Tn,id:s,strategy:l,resizeObserverConfig:c,transition:d=On}=t;const{items:u,containerId:h,activeIndex:p,disabled:g,disableTransforms:f,sortedRects:v,overIndex:m,useDragOverlay:b,strategy:x}=e.useContext(Mn),y=function(e,t){var n,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(n=null==e?void 0:e.draggable)?n:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(i,g),w=u.indexOf(s),j=e.useMemo(()=>({sortable:{containerId:h,index:w,items:u},...a}),[h,a,w,u]),S=e.useMemo(()=>u.slice(u.indexOf(s)),[u,s]),{rect:C,node:E,isOver:R,setNodeRef:D}=function(t){let{data:n,disabled:r=!1,id:i,resizeObserverConfig:a}=t;const o=Ce("Droppable"),{active:s,dispatch:l,over:c,measureDroppableContainers:d}=e.useContext(un),u=e.useRef({disabled:r}),h=e.useRef(!1),p=e.useRef(null),g=e.useRef(null),{disabled:f,updateMeasurementsFor:v,timeout:m}={...Sn,...a},b=xe(null!=v?v:i),x=Gt({callback:e.useCallback(()=>{h.current?(null!=g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{d(Array.isArray(b.current)?b.current:[b.current]),g.current=null},m)):h.current=!0},[m]),disabled:f||!s}),y=e.useCallback((e,t)=>{x&&(t&&(x.unobserve(t),h.current=!1),e&&x.observe(e))},[x]),[w,j]=we(y),S=xe(n);return e.useEffect(()=>{x&&w.current&&(x.disconnect(),h.current=!1,x.observe(w.current))},[w,x]),e.useEffect(()=>(l({type:Be.RegisterDroppable,element:{id:i,key:o,disabled:r,node:w,rect:p,data:S}}),()=>l({type:Be.UnregisterDroppable,key:o,id:i})),[i]),e.useEffect(()=>{r!==u.current.disabled&&(l({type:Be.SetDroppableDisabled,id:i,key:o,disabled:r}),u.current.disabled=r)},[i,o,r,l]),{active:s,rect:p,isOver:(null==c?void 0:c.id)===i,node:w,over:c,setNodeRef:j}}({id:s,data:j,disabled:y.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...c}}),{active:k,activatorEvent:I,activeNodeRect:A,attributes:M,setNodeRef:_,listeners:T,isDragging:N,over:O,setActivatorNodeRef:z,transform:L}=jn({id:s,data:j,attributes:{...Pn,...r},disabled:y.draggable}),P=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.useMemo(()=>e=>{n.forEach(t=>t(e))},n)}(D,_),q=Boolean(k),B=q&&!f&&Rn(p)&&Rn(m),F=!b&&N,W=F&&B?L:null,U=B?null!=W?W:(null!=l?l:x)({rects:v,activeNodeRect:A,activeIndex:p,overIndex:m,index:w}):null,H=Rn(p)&&Rn(m)?o({id:s,items:u,activeIndex:p,overIndex:m}):w,V=null==k?void 0:k.id,Y=e.useRef({activeId:V,items:u,newIndex:H,containerId:h}),$=u!==Y.current.items,X=n({active:k,containerId:h,isDragging:N,isSorting:q,id:s,index:w,items:u,newIndex:Y.current.newIndex,previousItems:Y.current.items,previousContainerId:Y.current.containerId,transition:d,wasDragging:null!=Y.current.activeId}),K=function(t){let{disabled:n,index:r,node:i,rect:a}=t;const[o,s]=e.useState(null),l=e.useRef(r);return me(()=>{if(!n&&r!==l.current&&i.current){const e=a.current;if(e){const t=tt(i.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&s(n)}}r!==l.current&&(l.current=r)},[n,r,i,a]),e.useEffect(()=>{o&&s(null)},[o]),o}({disabled:!X,index:w,node:E,rect:C});return e.useEffect(()=>{q&&Y.current.newIndex!==H&&(Y.current.newIndex=H),h!==Y.current.containerId&&(Y.current.containerId=h),u!==Y.current.items&&(Y.current.items=u)},[q,H,h,u]),e.useEffect(()=>{if(V===Y.current.activeId)return;if(null!=V&&null==Y.current.activeId)return void(Y.current.activeId=V);const e=setTimeout(()=>{Y.current.activeId=V},50);return()=>clearTimeout(e)},[V]),{active:k,activeIndex:p,attributes:M,data:j,rect:C,index:w,newIndex:H,items:u,isOver:R,isSorting:q,isDragging:N,listeners:T,node:E,overIndex:m,over:O,setNodeRef:P,setActivatorNodeRef:z,setDroppableNodeRef:D,setDraggableNodeRef:_,transform:null!=K?K:U,transition:function(){if(K||$&&Y.current.newIndex===w)return Ln;if(F&&!ke(I)||!d)return;if(q||X)return Ae.Transition.toString({...d,property:zn});return}()}}St.Down,St.Right,St.Up,St.Left;const Bn=({id:e,label:r,onDelete:i})=>{const{attributes:a,listeners:o,setNodeRef:s,transform:l,transition:c,isDragging:d}=qn({id:e}),u={transform:Ae.Transform.toString(l),transition:c,opacity:d?.5:1,cursor:d?"grabbing":"grab"};return t.jsxs(n,{ref:s,style:u,sx:{display:"flex",alignItems:"center",gap:.5,touchAction:"none"},children:[t.jsx(n,{...a,...o,sx:{display:"flex",alignItems:"center",cursor:"grab",color:"text.secondary","&:active":{cursor:"grabbing"}},children:t.jsx(Z,{fontSize:"small"})}),t.jsx(f,{label:r,onDelete:i,sx:{flex:1}})]})},Fn=({profileData:a,isEditing:o,allSkills:s,skillTypes:l})=>{const{control:u,register:p,formState:{errors:g},setValue:f}=D();return e.useEffect(()=>{if(o&&a){const e=ie(a),t=e.habilidades_que_se_saben??[],n=e.habilidades_por_aprender??[];f("habilidades_que_se_saben",Array.isArray(t)?t:[]),f("habilidades_por_aprender",Array.isArray(n)?n:[])}},[o,a,f]),t.jsxs(c,{sx:{width:"100%"},children:[" ",t.jsxs(d,{children:[t.jsx(r,{variant:"h6",sx:{mb:2},children:"Habilidades y Experiencia"}),!o&&t.jsxs(i,{spacing:3,children:[t.jsxs(n,{children:[t.jsx(r,{variant:"body1",sx:{fontWeight:"bold"},children:"Habilidades que puedes enseñar"}),(()=>{const e=a?.habilidades_que_se_saben??[];return e&&e.length>0?t.jsx(i,{component:"ul",spacing:.5,sx:{pl:2,m:0},children:e.map((e,n)=>{let i=null;i=e&&"object"==typeof e?e:s?.find(t=>t.id===e)||null;const a=i&&(i.nombre_habilidad||i.nombre)||String(e),o=i?.id??`habilidad-saben-${String(e)}-${n}`;return t.jsx(r,{component:"li",variant:"body1",children:a},o)})}):t.jsx(r,{variant:"body1",children:"Aún no has agregado tus habilidades para enseñar."})})()]}),t.jsxs(n,{children:[t.jsx(r,{variant:"body1",sx:{fontWeight:"bold"},children:"Habilidades que quieres aprender"}),(()=>{const e=a?.habilidades_por_aprender??[];return e&&e.length>0?t.jsx(i,{component:"ul",spacing:.5,sx:{pl:2,m:0},children:e.map((e,n)=>{let i=null;i=e&&"object"==typeof e?e:s?.find(t=>t.id===e)||null;const a=i&&(i.nombre_habilidad||i.nombre)||String(e),o=i?.id??`habilidad-aprender-${String(e)}-${n}`;return t.jsx(r,{component:"li",variant:"body1",children:a},o)})}):t.jsx(r,{variant:"body1",children:"Aún no has agregado habilidades por aprender."})})()]})]}),o&&t.jsxs(i,{spacing:4,sx:{mt:1},children:[t.jsxs(n,{children:[t.jsx(r,{variant:"subtitle1",sx:{mb:1},children:"Habilidades que puedes enseñar"}),t.jsx(k,{name:"habilidades_que_se_saben",control:u,render:({field:e})=>{const n=Array.isArray(e.value)?e.value:[],a=Array.from(new Set(n.map(e=>String(e)))).map(e=>{const t=s?.find(t=>String(t.id)===e||t.id==e);return t||{id:e,nombre_habilidad:`Habilidad ${e}`}});return t.jsxs(t.Fragment,{children:[t.jsx(v,{multiple:!0,options:s?[...s].sort((e,t)=>{const n=e.nombre_tipo||"Otras",r=t.nombre_tipo||"Otras",i=n.localeCompare(r);if(0===i){const n=e.nombre_habilidad||e.nombre||"",r=t.nombre_habilidad||t.nombre||"";return n.localeCompare(r)}return i}):[],getOptionLabel:e=>e.nombre_habilidad||e.nombre||"",isOptionEqualToValue:(e,t)=>e.id===t.id,value:a,onChange:(t,n)=>{const r=(n||[]).map(e=>e&&"object"==typeof e?e.id??e.value??e.key:e);e.onChange(r)},groupBy:e=>e.nombre_tipo||"Otras",renderInput:e=>t.jsx(h,{...e,label:"Selecciona habilidades que puedes enseñar",error:!!g.habilidades_que_se_saben,helperText:g.habilidades_que_se_saben?.message}),renderTags:()=>null}),a&&a.length>0?t.jsx(xn,{collisionDetection:Xe,onDragEnd:({active:t,over:n})=>{if(!n||t.id===n.id)return;const r=Array.isArray(e.value)?e.value:[],i=r.findIndex(e=>String(e)===String(t.id)),a=r.findIndex(e=>String(e)===String(n.id));if(-1!==i&&-1!==a){const t=Cn(r,i,a);e.onChange(t)}},children:t.jsx(_n,{items:a.map(e=>String(e.id??e.value??e.key)),strategy:In,children:t.jsx(i,{spacing:1,sx:{mt:1},children:a.map((n,r)=>{const i=n&&"object"==typeof n?n.id??n.value??n.key:n,a=n&&"object"==typeof n&&(n.nombre_habilidad||n.nombre||n.name)||String(i);return t.jsx(Bn,{id:String(i),label:a,onDelete:()=>{const t=(Array.isArray(e.value)?e.value:[]).filter(e=>String(e)!==String(i));e.onChange(t)}},null!=i?`skill-saben-${i}`:`skill-saben-${r}`)})})})}):t.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"No hay habilidades seleccionadas."})]})}})]}),t.jsxs(n,{children:[t.jsx(r,{variant:"subtitle1",sx:{mb:1},children:"Habilidades que quieres aprender"}),t.jsx(k,{name:"habilidades_por_aprender",control:u,render:({field:e})=>{const n=Array.isArray(e.value)?e.value:[],a=Array.from(new Set(n.map(e=>String(e)))).map(e=>{const t=s?.find(t=>String(t.id)===e||t.id==e);return t||{id:e,nombre_habilidad:`Habilidad ${e}`}});return t.jsxs(t.Fragment,{children:[t.jsx(v,{multiple:!0,options:s?[...s].sort((e,t)=>{const n=e.nombre_tipo||"Otras",r=t.nombre_tipo||"Otras",i=n.localeCompare(r);if(0===i){const n=e.nombre_habilidad||e.nombre||"",r=t.nombre_habilidad||t.nombre||"";return n.localeCompare(r)}return i}):[],getOptionLabel:e=>e.nombre_habilidad||e.nombre||"",isOptionEqualToValue:(e,t)=>e.id===t.id,value:a,onChange:(t,n)=>{const r=(n||[]).map(e=>e&&"object"==typeof e?e.id??e.value??e.key:e);e.onChange(r)},groupBy:e=>e.nombre_tipo||"Otras",renderInput:e=>t.jsx(h,{...e,label:"Selecciona habilidades por aprender",error:!!g.habilidades_por_aprender,helperText:g.habilidades_por_aprender?.message}),renderTags:()=>null}),a&&a.length>0?t.jsx(xn,{collisionDetection:Xe,onDragEnd:({active:t,over:n})=>{if(!n||t.id===n.id)return;const r=Array.isArray(e.value)?e.value:[],i=r.findIndex(e=>String(e)===String(t.id)),a=r.findIndex(e=>String(e)===String(n.id));if(-1!==i&&-1!==a){const t=Cn(r,i,a);e.onChange(t)}},children:t.jsx(_n,{items:a.map(e=>String(e.id??e.value??e.key)),strategy:In,children:t.jsx(i,{spacing:1,sx:{mt:1},children:a.map((n,r)=>{const i=n&&"object"==typeof n?n.id??n.value??n.key:n,a=n&&"object"==typeof n&&(n.nombre_habilidad||n.nombre||n.name)||String(i);return t.jsx(Bn,{id:String(i),label:a,onDelete:()=>{const t=(Array.isArray(e.value)?e.value:[]).filter(e=>String(e)!==String(i));e.onChange(t)}},null!=i?`skill-aprender-${i}`:`skill-aprender-${r}`)})})})}):t.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"No hay habilidades seleccionadas."})]})}})]})]})]})]})},Wn=({profileData:e,allSkills:n,skillTypes:r})=>t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(le,{profileData:e,isEditing:!1})}),t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(Fn,{profileData:e,isEditing:!1,allSkills:n,skillTypes:r})})]}),Un=({profileData:e,allSkills:n,skillTypes:r,isDirty:s,isSubmitting:l,onCancel:c})=>t.jsxs(u,{container:!0,spacing:2,children:[t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(le,{profileData:e,isEditing:!0})}),t.jsx(u,{size:{xs:12,sm:6},children:t.jsx(Fn,{profileData:e,isEditing:!0,allSkills:n,skillTypes:r})}),t.jsx(u,{size:{xs:12},children:t.jsxs(i,{direction:"row",spacing:2,sx:{mt:2},children:[t.jsx(a,{type:"submit",variant:"contained",disabled:!s||l,children:l?t.jsx(o,{size:24,color:"inherit"}):"CONFIRMAR CAMBIOS"}),t.jsx(a,{variant:"outlined",onClick:c,children:"Cancelar"})]})})]}),Hn=({review:e,isOwnReview:a,onEdit:o,onDelete:s,evaluadorInfo:l})=>{const h=(p=e.comentario)&&0!==p.length?p.length<=100?4:p.length<=200?6:12:4;var p;const g=l?`${l.nombre} ${l.apellido}`.trim():e.evaluador?`Usuario #${e.evaluador}`:"Usuario anónimo",f=l?.media||null,v=g.charAt(0).toUpperCase();return t.jsx(u,{size:{xs:12,sm:h},children:t.jsx(c,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",transition:"box-shadow 0.3s","&:hover":a?{boxShadow:3}:{}},children:t.jsxs(d,{sx:{flexGrow:1},children:[t.jsxs(i,{direction:"row",alignItems:"center",spacing:1.5,sx:{mb:1.5},children:[t.jsx(b,{src:f,sx:{width:32,height:32,bgcolor:"primary.main"},children:v}),t.jsx(n,{sx:{flexGrow:1},children:t.jsx(r,{variant:"body2",fontWeight:"bold",children:g})}),a&&t.jsxs(i,{direction:"row",spacing:.5,children:[t.jsx(x,{size:"small",onClick:()=>o(e),children:t.jsx(Y,{fontSize:"small"})}),t.jsx(x,{size:"small",color:"error",onClick:()=>s(e.id),children:t.jsx(ee,{fontSize:"small"})})]})]}),t.jsx(m,{value:e.puntuacion,readOnly:!0,size:"small",sx:{mb:1}}),e.comentario&&t.jsx(r,{variant:"body2",color:"text.secondary",sx:{wordBreak:"break-word",lineHeight:1.6},children:e.comentario})]})})})},Vn=({initialValue:o,onCancel:s,onSubmit:l})=>{const[c,d]=e.useState(o?.puntuacion||0),[u,p]=e.useState(o?.comentario||"");return t.jsxs(n,{sx:{mt:2},children:[t.jsxs(i,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[t.jsx(r,{variant:"body2",children:"Tu valoración:"}),t.jsx(m,{value:c,onChange:(e,t)=>d(t||0)})]}),t.jsx(h,{fullWidth:!0,multiline:!0,minRows:2,placeholder:"Escribe un comentario (opcional)",value:u,onChange:e=>p(e.target.value)}),t.jsxs(i,{direction:"row",spacing:1,sx:{mt:1.5},children:[t.jsx(a,{variant:"contained",onClick:()=>l({puntuacion:c,comentario:u}),disabled:c<1,children:"Guardar"}),t.jsx(a,{variant:"text",onClick:s,children:"Cancelar"})]})]})},Yn=({profileData:o})=>{const{user:s}=F(),{showToast:l}=L(),{reviews:h,loading:p,ownReview:g,evaluadoresInfo:f,fetchReviews:v,saveReview:b,deleteReview:x}=((t,n)=>{const[r,i]=e.useState([]),[a,o]=e.useState(!1),[s,l]=e.useState({}),c=!t||n&&String(n)===String(t),d=r.find(e=>e.evaluador===n)||null,u=e.useCallback(async()=>{if(t){o(!0);try{const e=(await N.get(B.listar)).data||[],n=t?e.filter(e=>e.evaluado===parseInt(t)):e;i(n),(async()=>{const e={};for(const r of n)if(!e[r.evaluador])try{const t=await N.get(_.detalle(r.evaluador));e[r.evaluador]=t.data}catch(t){e[r.evaluador]=null}l(t=>({...t,...e}))})()}catch(e){throw i([]),e}finally{o(!1)}}},[t]),h=e.useCallback(async(e,n)=>{if(!t)throw new Error("No profile ID");try{d?await N.put(B.detalle(d.id),{evaluado:t,puntuacion:n,comentario:e}):await N.post(B.listar,{evaluado:t,puntuacion:n,comentario:e}),await u()}catch(r){throw r}},[d,t,u]),p=e.useCallback(async e=>{try{await N.delete(B.detalle(e)),await u()}catch(t){throw t}},[u]);return{reviews:r,loading:a,isOwnProfile:c,ownReview:d,evaluadoresInfo:s,fetchReviews:u,saveReview:h,deleteReview:p}})(o?.id,s?.id),[y,w]=e.useState(null),j=o?.id,S=e.useMemo(()=>{if(!h||0===h.length)return 0;const e=h.reduce((e,t)=>e+(t.puntuacion||0),0);return Math.round(e/h.length*10)/10},[h]),C=h?.length||0,E=Boolean(s&&j&&String(s.id)!==String(j));e.useEffect(()=>{j&&v()},[j,v]);const R=async e=>{try{await x(e),l("Reseña eliminada","success")}catch(t){l(t.response?.data?.message||"Error al eliminar reseña","error")}};return t.jsx(c,{sx:{width:"100%"},children:t.jsxs(d,{children:[t.jsx(r,{variant:"h6",sx:{mb:2},children:"Valoraciones y Reseñas"}),t.jsxs(n,{display:"flex",alignItems:"center",mb:1,children:[t.jsx(r,{variant:"h4",component:"span",sx:{mr:1},children:S||0}),t.jsx(m,{value:S||0,precision:.5,readOnly:!0})]}),t.jsx(r,{variant:"body2",color:"text.secondary",children:C>0?`Basado en ${C} reseña${1!==C?"s":""}.`:"Aún no hay reseñas."}),E&&t.jsx(n,{sx:{mt:2},children:y||!g?t.jsx(Vn,{initialValue:g||void 0,onCancel:()=>w(null),onSubmit:async({puntuacion:e,comentario:t})=>{try{await b(t,e),l("Reseña guardada correctamente","success"),w(null)}catch(n){l(n.response?.data?.message||"Error al guardar reseña","error")}}}):t.jsxs(i,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[t.jsx(r,{variant:"body2",children:"Ya has dejado una valoración."}),t.jsx(a,{variant:"text",size:"small",onClick:()=>w(g),children:"Editar la tuya"}),t.jsx(a,{variant:"text",size:"small",color:"error",onClick:()=>R(g.id),children:"Eliminar"})]})}),t.jsxs(n,{sx:{mt:3},children:[p&&t.jsx(r,{variant:"body2",color:"text.secondary",children:"Cargando reseñas..."}),!p&&0===h.length&&t.jsx(n,{sx:{p:2,border:"1px dashed #ccc",textAlign:"center"},children:t.jsx(r,{variant:"body2",color:"text.secondary",children:"No hay valoraciones para este usuario."})}),!p&&h.length>0&&t.jsx(u,{container:!0,spacing:2,children:h.map(e=>t.jsx(Hn,{review:e,isOwnReview:g?.id===e.id,onEdit:e=>w(e),onDelete:R,evaluadorInfo:f[e.evaluador]||null},e.id))})]})]})})},$n=()=>{const{id:r}=H();U();const{logout:i,user:a}=F(),{showToast:o}=L(),[c,d]=e.useState(!1),{sendRequest:h,acceptRequest:p,rejectRequest:g,requests:f,actionLoading:v}=V(),{profileData:m,isLoading:b,error:x,allSkills:y,skillTypes:w,updateProfile:j,clearError:S,fetchProfile:C}=((t=null)=>{const[n,r]=e.useState(null),[i,a]=e.useState(!0),[o,s]=e.useState([]),[l,c]=e.useState([]),{error:d,handleError:u,clearError:h}=W(),p=e.useCallback(async()=>{a(!0),h();try{const e=t?_.detalle(t):T.USER,n=await N.get(e);return r(n.data),n.data}catch(e){return u(e,"fetchProfile"),null}finally{a(!1)}},[t,h,u]),g=e.useCallback(async()=>{try{const[e,t]=await Promise.all([N.get(O),N.get(z)]);s(e.data),c(t.data)}catch(e){u(e,"fetchSkillData")}},[u]),f=e=>{const t={...e};return t.media&&"string"==typeof t.media&&delete t.media,Array.isArray(t.habilidades_que_se_saben)||(t.habilidades_que_se_saben=[]),Array.isArray(t.habilidades_por_aprender)||(t.habilidades_por_aprender=[]),t},v=e=>{const t=new FormData;return Object.entries(e).forEach(([e,n])=>{if("habilidades_que_se_saben"===e&&Array.isArray(n))n.forEach(e=>t.append("habilidades_que_se_saben",e));else if("habilidades_por_aprender"===e&&Array.isArray(n))n.forEach(e=>t.append("habilidades_por_aprender",e));else if("media"===e){const e=n instanceof FileList?n[0]:n;e instanceof File&&t.append("media",e)}else null!=n&&""!==n&&t.append(e,n)}),t};return e.useEffect(()=>{p(),g()},[p,g]),{profileData:n,isLoading:i,error:d,allSkills:o,skillTypes:l,fetchProfile:p,updateProfile:async(e,i=!1)=>{h();try{const a=i?v(e):f(e),o=t||n?.id,s=o?_.detalle(o):_.me,l=await N.patch(s,a);return r(l.data),l.data}catch(a){return u(a,"updateProfile"),null}},clearError:h}})(r),{matchStatus:E,pendingRequestId:R,updateMatchStatus:D,handleStartChat:k,handleRemoveFriend:B,setMatchStatus:Y,setPendingRequestId:$,startingChat:X}=((t,n,r)=>{const i=U(),{showToast:a}=L(),[o,s]=e.useState(null),[l,c]=e.useState(null),[d,u]=e.useState(!1),h=e=>e?.matches?.some(e=>String(e)===String(n?.id)),p=e.useCallback((e,n)=>{if(h(e))return s("matched"),void c(null);if(!t||!n)return;const r=n.find(e=>e.emisor&&String(e.emisor.id)===String(t)&&("indefinido"===e.estado||"pendiente"===e.estado));r?(s("pending-received"),c(r.id)):(s(null),c(null))},[t,n?.id]),g=e.useCallback(async()=>{if(t)try{u(!0);const e=(await N.get(P.conversaciones)).data.find(e=>e.participantes&&e.participantes.includes(parseInt(t)));if(e)return void i(q.CHAT_CONVERSACION(e.id));const n=await N.post(P.conversaciones,{participantes:[parseInt(t)]});n.data&&n.data.id&&(i(q.CHAT_CONVERSACION(n.data.id)),a("Conversación iniciada","success"))}catch(e){a("Error al iniciar la conversación","error")}finally{u(!1)}},[t,i,a]),f=e.useCallback(async()=>{if(t&&window.confirm("¿Eliminar a este amigo? Esta acción no se puede deshacer."))try{await N.delete(_.coincidenciaById(t)),await r(),s(null),a("Amigo eliminado correctamente","success")}catch(e){const t=e.response?.data?.message||e.response?.data?.error||"Error al eliminar amigo";a(t,"error")}},[t,r,a]);return{matchStatus:o,pendingRequestId:l,isFriend:h,updateMatchStatus:p,handleStartChat:g,handleRemoveFriend:f,setMatchStatus:s,setPendingRequestId:c,startingChat:d}})(r,a,C),K=!r||a&&String(a.id)===String(r),G=I({resolver:M(re),defaultValues:{nombre:"",apellido:"",year:0,telefono:"",habilidades_que_se_saben:[],habilidades_por_aprender:[],email:"",media:""}}),{reset:J,formState:{isDirty:Q,isSubmitting:Z}}=G;e.useEffect(()=>{m&&J(ie(m))},[m,J]),e.useEffect(()=>{m&&!K&&D(m,f)},[m,f,K,D]);return b?t.jsx(oe,{}):m?t.jsx(n,{sx:{bgcolor:"background.default",minHeight:"calc(100vh - 64px)"},children:t.jsxs(s,{maxWidth:"md",sx:{py:4},children:[t.jsx(ae,{isOwnProfile:K,isEditing:c,onEdit:()=>d(!0),onSendMatchRequest:K?void 0:async()=>{if(!r)return;const e=await h(parseInt(r));e.success?(Y("pending"),o("¡Solicitud enviada! Espera a que la acepten","success")):o(e.error||"Error al enviar solicitud","error")},onAcceptRequest:K?void 0:async()=>{if(!R)return;const e=await p(R);e.success?(Y("matched"),$(null),o("¡Match aceptado! Ahora pueden chatear","success")):o(e.error||"Error al aceptar solicitud","error")},onRejectRequest:K?void 0:async()=>{if(!R)return;const e=await g(R);e.success?(Y(null),$(null),o("Solicitud rechazada","info")):o(e.error||"Error al rechazar solicitud","error")},onStartChat:K?void 0:k,onRemoveFriend:K?void 0:B,matchStatus:E,isSendingRequest:null!==v,isStartingChat:X}),x&&t.jsx(l,{severity:"error",sx:{mb:2},children:x}),t.jsxs(u,{container:!0,direction:"column",spacing:2,mb:2,children:[t.jsx(A,{...G,children:t.jsx(n,{component:c?"form":"div",onSubmit:c?G.handleSubmit(async e=>{S();const t=e.media&&(e.media instanceof File||e.media instanceof FileList&&e.media.length>0),n=await j(e,t);n&&(J(ie(n)),d(!1),o("Perfil actualizado correctamente","success"))}):void 0,children:K&&c?t.jsx(Un,{profileData:m,allSkills:y,skillTypes:w,isDirty:Q,isSubmitting:Z,onCancel:()=>{J(),d(!1)}}):t.jsx(Wn,{profileData:m,allSkills:y,skillTypes:w})})}),t.jsx(u,{size:{xs:12},children:t.jsx(Yn,{profileData:m})})]})]})}):t.jsx(se,{error:x,onLogout:i})};export{$n as default};
