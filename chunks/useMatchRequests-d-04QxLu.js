import{r as e}from"./mui-core-BpoTvZsj.js";import{a as r,c as a,S as s,U as t}from"../index-BF7ALLnG.js";import{f as n,e as i}from"./skillsCache-DM44Hx6q.js";const l=()=>{const{user:l}=r(),[o,c]=e.useState([]),[u,d]=e.useState(!1),[m,p]=e.useState(null),[f,b]=e.useState(null),h=e.useRef(null),y=e.useCallback(async()=>{h.current&&h.current.abort();const e=new AbortController;h.current=e;try{d(!0),p(null);const[r,o]=await Promise.all([a.get(s.listar,{signal:e.signal}),n()]),u=r.data.filter(e=>("indefinido"===e.estado||"pendiente"===e.estado)&&e.recipiente===l?.id),m=Array.from(new Set(u.map(e=>e.emisor))),f=await Promise.all(m.map(async r=>{try{return[r,(await a.get(t.detalle(r),{signal:e.signal})).data]}catch(s){return[r,null]}})),b=Object.fromEntries(f),h=u.map(e=>{const r=b[e.emisor];return r?{...e,emisor:{...r,habilidades_ofrecer:i(r.habilidades_que_se_saben,o),habilidades_aprender:i(r.habilidades_por_aprender,o)}}:{...e,emisor:{id:e.emisor,nombre:"Usuario",apellido:"",habilidades_ofrecer:[],habilidades_aprender:[]}}});e.signal.aborted||(c(h),p(null))}catch(r){if("ERR_CANCELED"===r?.code||"CanceledError"===r?.name)return;const e=r.response?.data?.message||"Error al cargar solicitudes";p(e)}finally{e.signal.aborted||d(!1)}},[l?.id]),g=e.useCallback(async e=>{try{return b(e),await a.post("/solicitudes-match/",{recipiente:e}),await y(),p(null),{success:!0}}catch(r){let e="Error al enviar solicitud";if(r.response?.data){const a=r.response.data;a.message?e=a.message:a.error?e=a.error:a.non_field_errors&&Array.isArray(a.non_field_errors)?e=a.non_field_errors[0]:a.detail&&(e=a.detail)}return p(e),{success:!1,error:e}}finally{b(null)}},[y]),_=e.useCallback(async e=>{try{return b(e),await a.post(`/solicitudes-match/${e}/aceptar/`),await y(),p(null),{success:!0}}catch(r){const e=r.response?.data?.message||r.response?.data?.error||"Error al aceptar solicitud";return p(e),{success:!1,error:e}}finally{b(null)}},[y]),w=e.useCallback(async e=>{try{return b(e),await a.post(`/solicitudes-match/${e}/rechazar/`),await y(),p(null),{success:!0}}catch(r){const e=r.response?.data?.message||r.response?.data?.error||"Error al rechazar solicitud";return p(e),{success:!1,error:e}}finally{b(null)}},[y]);return e.useEffect(()=>(y(),()=>{h.current&&h.current.abort()}),[y]),{requests:o,loading:u,error:m,actionLoading:f,fetchRequests:y,sendRequest:g,acceptRequest:_,rejectRequest:w}};export{l as u};
