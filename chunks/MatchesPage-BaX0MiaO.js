import{r as e,R as a,j as r,p as s,q as n,G as t,s as i,B as l,T as o,k as d,t as c,A as u,d as h,C as x,m}from"./mui-core-CIRgtlGz.js";import{b as p,R as j,c as b,U as f}from"../index-BM7OiNGa.js";import{u as g}from"./useErrorHandler-D2QZLQ7X.js";import{A as y}from"./mui-icons-BQP8OJas.js";import{b as v}from"./vendor-CoiQIOlL.js";import"./http-Dos3PyFQ.js";const C=e=>e&&"object"==typeof e?e.nombre_habilidad||e.nombre||JSON.stringify(e):String(e),_={mutual:"Coincidencia mutua",teach:"Puede enseñarte",learn:"Puede aprender de ti"},k={mutual:"Coincidencias mutuas",teach:"Usuarios que te pueden enseñar",learn:"Usuarios que pueden aprender de ti"},w={mutual:"No tienes coincidencias mutuas aún.",teach:"No hay usuarios que te puedan enseñar tus habilidades deseadas.",learn:"No hay usuarios que puedan aprender tus habilidades."};const z=a.memo(function({user:e,habilidadesOfrecer:a,habilidadesBuscar:u,tipo:h,onClick:x}){const m=(a||[]).map(C),p=(u||[]).map(C),j="mutual"===h&&u;return r.jsx(s,{sx:{mb:2,width:"100%",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:3}},onClick:()=>x&&x(e.id),children:r.jsx(n,{children:r.jsxs(t,{container:!0,spacing:2,alignItems:"flex-start",children:[r.jsxs(t,{size:{xs:12,md:j?4:7},sx:{display:"flex",alignItems:"center",gap:2},children:[r.jsx(i,{src:e.media,alt:e.nombre,sx:{width:60,height:60},children:e.nombre?.charAt(0).toUpperCase()}),r.jsxs(l,{sx:{minWidth:0,flex:1},children:[r.jsxs(o,{variant:"h6",children:[e.nombre," ",e.apellido]}),e.email&&r.jsx(o,{variant:"body2",color:"text.secondary",sx:{wordBreak:"break-word"},children:e.email}),r.jsx(o,{variant:"body2",color:"text.secondary",children:_[h]})]})]}),j?r.jsxs(r.Fragment,{children:[r.jsxs(t,{size:{xs:12,md:4},children:[r.jsx(o,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Puede enseñarte"}),m.length>0?r.jsxs(d,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[m.slice(0,4).map((e,a)=>r.jsx(c,{label:e,size:"small",variant:"outlined"},a)),m.length>4&&r.jsx(c,{label:"+"+(m.length-4),size:"small",variant:"outlined"})]}):r.jsx(o,{variant:"body2",color:"text.secondary",children:"Sin datos"})]}),r.jsxs(t,{size:{xs:12,md:4},children:[r.jsx(o,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Quiere aprender"}),p.length>0?r.jsxs(d,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[p.slice(0,4).map((e,a)=>r.jsx(c,{label:e,size:"small",variant:"outlined",color:"secondary"},a)),p.length>4&&r.jsx(c,{label:"+"+(p.length-4),size:"small",variant:"outlined",color:"secondary"})]}):r.jsx(o,{variant:"body2",color:"text.secondary",children:"Sin datos"})]})]}):r.jsxs(t,{size:{xs:12,md:5},children:[r.jsx(o,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:_[h]}),m.length>0?r.jsxs(d,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[m.slice(0,5).map((e,a)=>r.jsx(c,{label:e,size:"small",variant:"outlined"},a)),m.length>5&&r.jsx(c,{label:"+"+(m.length-5),size:"small",variant:"outlined"})]}):r.jsx(o,{variant:"body2",color:"text.secondary",children:"Sin datos"})]})]})})})});function S({tipo:e,users:a,hasMore:s,onLoadMore:n,onUserClick:i,fullWidth:d=!1}){return r.jsxs(l,{sx:{mb:d?4:0},children:[r.jsx(o,{variant:"h6",sx:{mb:2},children:k[e]}),a.length>0?d?r.jsx(t,{container:!0,spacing:2,children:a.map((a,s)=>r.jsx(t,{size:{xs:12},children:r.jsx(z,{user:a,habilidadesOfrecer:"mutual"===e?a.puede_ensenar:a["teach"===e?"puede_ensenar":"puede_aprender"],habilidadesBuscar:"mutual"===e?a.puede_aprender:void 0,tipo:e,onClick:i})},a.id||s))}):a.map((a,s)=>r.jsx(z,{user:a,habilidadesOfrecer:"mutual"===e?a.puede_ensenar:a["teach"===e?"puede_ensenar":"puede_aprender"],habilidadesBuscar:"mutual"===e?a.puede_aprender:void 0,tipo:e,onClick:i},a.id||s)):r.jsx(u,{severity:"info",children:w[e]}),s&&r.jsx(l,{sx:{display:"flex",justifyContent:"center",mt:2},children:r.jsx(h,{variant:"outlined",endIcon:r.jsx(y,{}),onClick:n,children:"Ver más"})})]})}function E(){const s=v(),{addToast:n}=p(),[i,o]=e.useState({mutual:1,teach:1,learn:1}),[d,c]=e.useState([]),[u,h]=e.useState([]),[y,C]=e.useState([]),_=e.useCallback(e=>{s(j.USUARIO_BY_ID(e))},[s]),k=e.useCallback(e=>{o(a=>({...a,[e]:a[e]+1}))},[]),{data:w,loading:z}=((a,r=[],s={})=>{const{onSuccess:n,onError:t,initialData:i=null}=s,[l,o]=e.useState(i),[d,c]=e.useState(!1),u=e.useRef(!0),h=e.useRef(null),{error:x,handleError:m,clearError:p}=g(),j=e.useCallback(async()=>{c(!0),p(),h.current&&h.current.abort();const e=new AbortController;h.current=e;try{const r=await a({signal:e.signal});if(!u.current)return;o(r),n?.(r)}catch(r){if(!u.current)return;"ERR_CANCELED"===r?.code||"CanceledError"===r?.name||(m(r,"useFetchData"),t?.(r))}finally{u.current&&c(!1)}},[a,p,m,n,t]);return e.useEffect(()=>(u.current=!0,j(),()=>{u.current=!1,h.current&&h.current.abort()}),r),{data:l,loading:d,error:x,refetch:e.useCallback(async()=>{await j()},[j]),clearError:p}})(async({signal:e})=>(await b.get(f.coincidencias,{signal:e})).data||[],[]);if(a.useEffect(()=>{if(w&&w.length>0){const{mutual:e,teach:a,learn:r}=(e=>{const a=e=>Array.isArray(e)&&e.length>0,r=e=>!Array.isArray(e)||0===e.length;return{mutual:e.filter(e=>a(e.puede_ensenar)&&a(e.puede_aprender)),teach:e.filter(e=>a(e.puede_ensenar)&&r(e.puede_aprender)),learn:e.filter(e=>a(e.puede_aprender)&&r(e.puede_ensenar))}})(w);c(e),h(a),C(r)}},[w]),z&&0===d.length&&0===u.length&&0===y.length)return r.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:r.jsx(x,{size:60})});return r.jsx(m,{maxWidth:"lg",sx:{py:4},children:r.jsxs(t,{container:!0,spacing:4,children:[r.jsx(t,{size:{xs:12},children:r.jsx(S,{tipo:"mutual",users:d.slice(0,5*i.mutual),hasMore:5*i.mutual<d.length,onLoadMore:()=>k("mutual"),onUserClick:_,fullWidth:!1})}),r.jsx(t,{size:{xs:12,md:6},children:r.jsx(S,{tipo:"teach",users:u.slice(0,5*i.teach),hasMore:5*i.teach<u.length,onLoadMore:()=>k("teach"),onUserClick:_,fullWidth:!1})}),r.jsx(t,{size:{xs:12,md:6},children:r.jsx(S,{tipo:"learn",users:y.slice(0,5*i.learn),hasMore:5*i.learn<y.length,onLoadMore:()=>k("learn"),onUserClick:_,fullWidth:!0})})]})})}export{E as default};
