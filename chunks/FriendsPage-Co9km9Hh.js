import{r as e,R as s,j as r,q as a,s as t,k as n,x as i,B as o,T as l,u as c,y as d,d as x,C as m,m as h,n as u,o as p,z as j}from"./mui-core-BpoTvZsj.js";import{a as g,C as f,P as b,R as y,S as C}from"./mui-icons-58CkGrMT.js";import{c as v,A as w,U as A,b as z,R as _}from"../index-DnYbmb9J.js";import{f as S,e as R}from"./skillsCache-DrFCtLmv.js";import{u as E}from"./useConversations-B4lMqbLN.js";import{b as I}from"./vendor-47kkluUf.js";import"./http-Dos3PyFQ.js";const k=s.memo(({friend:s})=>{const h=I(),{getOrCreateConversation:u}=E(),{showToast:p}=z(),[j,b]=e.useState(!1),{id:y,nombre:C="Usuario",apellido:v="",email:w="",media:A,foto_perfil:S,habilidades_ofrecer:R=[],habilidades_aprender:k=[]}=s,P=A||S,B=e=>e?.nombre||e?.name||e||"";return r.jsxs(a,{sx:{mb:2,"&:hover":{boxShadow:3,transform:"translateY(-2px)",transition:"all 0.2s"}},children:[r.jsx(t,{children:r.jsxs(n,{direction:"row",spacing:2,alignItems:"flex-start",children:[r.jsx(i,{src:P,alt:`${C} ${v}`,sx:{width:60,height:60},children:!P&&r.jsx(g,{})}),r.jsxs(o,{sx:{flex:1},children:[r.jsxs(l,{variant:"h6",gutterBottom:!0,children:[C," ",v]}),r.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:w}),R.length>0&&r.jsxs(o,{sx:{mb:1},children:[r.jsx(l,{variant:"caption",color:"text.secondary",display:"block",children:"Puede enseñar:"}),r.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[R.slice(0,3).map((e,s)=>r.jsx(c,{label:B(e),size:"small",color:"primary",variant:"outlined",sx:{mt:.5}},e?.id||e?.nombre||e?.name||s)),R.length>3&&r.jsx(c,{label:"+"+(R.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),k.length>0&&r.jsxs(o,{children:[r.jsx(l,{variant:"caption",color:"text.secondary",display:"block",children:"Quiere aprender:"}),r.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[k.slice(0,3).map((e,s)=>r.jsx(c,{label:B(e),size:"small",color:"secondary",variant:"outlined",sx:{mt:.5}},e?.id||e?.nombre||e?.name||s)),k.length>3&&r.jsx(c,{label:"+"+(k.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]})]})]})}),r.jsxs(d,{sx:{justifyContent:"flex-end",px:2,pb:2},children:[r.jsx(x,{size:"small",onClick:()=>{h(_.USUARIO_BY_ID(y))},children:"Ver Perfil"}),r.jsx(x,{variant:"contained",color:"primary",startIcon:j?r.jsx(m,{size:16,color:"inherit"}):r.jsx(f,{}),onClick:async()=>{try{b(!0);const e=await u(y);h(_.CHAT_CONVERSACION(e.id))}catch(e){p("No se pudo abrir el chat. Intenta de nuevo.","error")}finally{b(!1)}},size:"small",disabled:j,children:j?"Abriendo...":"Chatear"})]})]})}),P=()=>{const{friends:s,loading:a,error:t,fetchFriends:i}=(()=>{const[s,r]=e.useState([]),[a,t]=e.useState(!1),[n,i]=e.useState(null),o=e.useRef(!0),l=e.useRef(null),c=e.useCallback(async()=>{try{t(!0),i(null),l.current&&l.current.abort();const e=new AbortController;l.current=e;const[s,a]=await Promise.all([v.get(w.USER,{signal:e.signal}),S()]),n=s.data.id,c=(await v.get(A.detalle(n),{signal:e.signal})).data.matches||[],d=[...new Set(c)];if(0===d.length)return o.current&&(r([]),i(null)),void t(!1);const x=(await Promise.all(d.map(async s=>{try{const r=(await v.get(A.detalle(s),{signal:e.signal})).data;return{...r,habilidades_ofrecer:R(r.habilidades_que_se_saben,a),habilidades_aprender:R(r.habilidades_por_aprender,a)}}catch(r){return null}}))).filter(e=>null!==e);o.current&&(r(x),i(null))}catch(e){if("CanceledError"===e?.name||"ERR_CANCELED"===e?.code)return;const s=e.response?.data?.message||"Error al cargar amigos";o.current&&i(s)}finally{o.current&&t(!1)}},[]);return e.useEffect(()=>(o.current=!0,c(),()=>{o.current=!1,l.current&&l.current.abort()}),[c]),{friends:s,loading:a,error:n,fetchFriends:c}})(),{showToast:c}=z(),[d,g]=e.useState("");e.useEffect(()=>{t&&c(t,"error")},[t,c]);const f=d.trim().toLowerCase(),_=s.filter(e=>{const s=(e.nombre||"").toLowerCase(),r=(e.apellido||"").toLowerCase(),a=(e.email||"").toLowerCase();return`${s} ${r}`.trim().includes(f)||a.includes(f)});return a&&0===s.length?r.jsx(o,{sx:{display:"flex",justifyContent:"center",py:8},children:r.jsx(m,{})}):r.jsxs(h,{maxWidth:"md",sx:{py:4},children:[r.jsxs(n,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,mb:3,children:[r.jsx(b,{sx:{fontSize:40,color:"primary.main"}}),r.jsxs(o,{sx:{flex:1,ml:1},children:[r.jsx(l,{variant:"h4",fontWeight:"bold",children:"Mis Amigos"}),r.jsxs(l,{variant:"body2",color:"text.secondary",children:[s.length," ",1===s.length?"amigo":"amigos"]})]}),r.jsx(x,{variant:"outlined",startIcon:a?r.jsx(m,{size:16}):r.jsx(y,{}),onClick:i,disabled:a,children:a?"Actualizando…":"Actualizar"})]}),s.length>0&&r.jsx(u,{fullWidth:!0,placeholder:"Buscar por nombre o email...",value:d,onChange:e=>g(e.target.value),sx:{mb:3},InputProps:{startAdornment:r.jsx(p,{position:"start",children:r.jsx(C,{})})}}),0===s.length?r.jsxs(j,{sx:{p:6,textAlign:"center"},children:[r.jsx(b,{sx:{fontSize:64,color:"text.secondary",mb:2}}),r.jsx(l,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aún no tienes amigos"}),r.jsx(l,{variant:"body2",color:"text.secondary",children:"Acepta solicitudes de match para empezar a conectar con otros usuarios"})]}):0===_.length?r.jsx(j,{sx:{p:4,textAlign:"center"},children:r.jsxs(l,{variant:"body1",color:"text.secondary",children:['No se encontraron amigos con "',d,'"']})}):r.jsx(o,{children:_.map(e=>r.jsx(k,{friend:e},e.id))})]})};export{P as default};
