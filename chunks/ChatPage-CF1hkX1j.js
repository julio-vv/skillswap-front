import{r as e,j as t,B as n,C as r,A as a,d as o,T as i,n as s,o as c,L as u,D as d,E as l,F as h,H as f,l as m,x as g,J as p,z as y,I as w,K as b,M as v}from"./mui-core-BpoTvZsj.js";import{S as x,l as j}from"./mui-icons-Bcg_AGA-.js";import{c as M,C,A as S,b as T}from"../index-BF7ALLnG.js";import{u as D}from"./useConversations-CdxEXnnV.js";import{c as k}from"./vendor-47kkluUf.js";import"./http-Dos3PyFQ.js";const P=({conversations:y=[],loading:w=!1,error:b=null,selectedConversationId:v,onSelectConversation:j,onRetry:M})=>{const[C,S]=e.useState("");if(w)return t.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:t.jsx(r,{})});if(b)return t.jsxs(n,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",p:2,children:[t.jsx(a,{severity:"error",sx:{mb:2,width:"100%"},children:b}),t.jsx(o,{variant:"outlined",size:"small",onClick:M,children:"Reintentar"})]});if(!y||0===y.length)return t.jsxs(n,{p:3,textAlign:"center",children:[t.jsx(i,{color:"text.secondary",children:"No tienes conversaciones aún"}),t.jsx(i,{variant:"body2",color:"text.secondary",mt:1,children:"Inicia una conversación desde la lista de amigos"})]});const T=y.filter(e=>{if(!C)return!0;const t=e.otherUser,n=C.toLowerCase();return t?.nombre?.toLowerCase().includes(n)||t?.apellido?.toLowerCase().includes(n)||t?.email?.toLowerCase().includes(n)}),D=v?Number(v):null;return t.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[t.jsx(n,{p:2,pb:1,children:t.jsx(s,{id:"search-conversations",name:"search-conversations",fullWidth:!0,size:"small",placeholder:"Buscar conversación...",value:C,onChange:e=>S(e.target.value),InputProps:{startAdornment:t.jsx(c,{position:"start",children:t.jsx(x,{})})}})}),t.jsx(u,{sx:{flex:1,overflow:"auto",py:0},children:0===T.length?t.jsx(n,{p:3,textAlign:"center",children:t.jsx(i,{color:"text.secondary",children:"No se encontraron conversaciones"})}):T.map((e,r)=>{const a=e.otherUser,o=Number(e.id)===D,s=e.unreadCount>0;return t.jsxs(n,{children:[r>0&&t.jsx(d,{}),t.jsx(l,{disablePadding:!0,children:t.jsxs(h,{selected:o,onClick:()=>j(e.id),sx:{py:2,"&.Mui-selected":{backgroundColor:"action.selected"}},children:[t.jsx(f,{children:t.jsx(m,{badgeContent:s?e.unreadCount:0,color:"error",overlap:"circular",children:t.jsx(g,{src:a?.media||a?.foto_perfil,alt:`${a?.nombre||""} ${a?.apellido||""}`,children:a?.nombre?.[0]?.toUpperCase()||"?"})})}),t.jsx(p,{primary:t.jsxs(i,{variant:"subtitle2",fontWeight:s?"bold":"normal",children:[a?.nombre," ",a?.apellido]}),secondary:t.jsx(i,{component:"span",variant:"body2",color:"text.secondary",sx:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:s?"medium":"normal"},children:e.ultimo_mensaje?.contenido||(e.fecha_actualizacion?new Date(e.fecha_actualizacion).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}):"Sin mensajes")})})]})})]},e.id)})})]})};var E,W={exports:{}};var R,H,N=(E||(E=1,R=W,H=W.exports,function(e){var t=e.setTimeout,n=e.clearTimeout,r=e.XMLHttpRequest,a=e.XDomainRequest,o=e.ActiveXObject,i=e.EventSource,s=e.document,c=e.Promise,u=e.fetch,d=e.Response,l=e.TextDecoder,h=e.TextEncoder,f=e.AbortController;if("undefined"==typeof window||void 0===s||"readyState"in s||null!=s.body||(s.readyState="loading",window.addEventListener("load",function(e){s.readyState="complete"},!1)),null==r&&null!=o&&(r=function(){return new o("Microsoft.XMLHTTP")}),null==Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),Date.now||(Date.now=function(){return(new Date).getTime()}),null==f){var m=u;u=function(e,t){var n=t.signal;return m(e,{headers:t.headers,credentials:t.credentials,cache:t.cache}).then(function(e){var t=e.body.getReader();return n._reader=t,n._aborted&&n._reader.cancel(),{status:e.status,statusText:e.statusText,headers:e.headers,body:{getReader:function(){return t}}}})},f=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){null!=this.signal._reader&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function g(){this.bitsNeeded=0,this.codePoint=0}g.prototype.decode=function(e){function t(e,t,n){if(1===n)return e>=128>>t&&e<<t<=2047;if(2===n)return e>=2048>>t&&e<<t<=55295||e>=57344>>t&&e<<t<=65535;if(3===n)return e>=65536>>t&&e<<t<=1114111;throw new Error}function n(e,t){if(6===e)return t>>6>15?3:t>31?2:1;if(12===e)return t>15?3:2;if(18===e)return 3;throw new Error}for(var r=65533,a="",o=this.bitsNeeded,i=this.codePoint,s=0;s<e.length;s+=1){var c=e[s];0!==o&&(c<128||c>191||!t(i<<6|63&c,o-6,n(o,i)))&&(o=0,i=r,a+=String.fromCharCode(i)),0===o?(c>=0&&c<=127?(o=0,i=c):c>=192&&c<=223?(o=6,i=31&c):c>=224&&c<=239?(o=12,i=15&c):c>=240&&c<=247?(o=18,i=7&c):(o=0,i=r),0===o||t(i,o,n(o,i))||(o=0,i=r)):(o-=6,i=i<<6|63&c),0===o&&(i<=65535?a+=String.fromCharCode(i):(a+=String.fromCharCode(55296+(i-65535-1>>10)),a+=String.fromCharCode(56320+(i-65535-1&1023))))}return this.bitsNeeded=o,this.codePoint=i,a},null!=l&&null!=h&&function(){try{return"test"===(new l).decode((new h).encode("test"),{stream:!0})}catch(e){}return!1}()||(l=g);var p=function(){};function y(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=p,this.onload=p,this.onerror=p,this.onreadystatechange=p,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=p}function w(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+32)})}function b(e){for(var t=Object.create(null),n=e.split("\r\n"),r=0;r<n.length;r+=1){var a=n[r].split(": "),o=a.shift(),i=a.join(": ");t[w(o)]=i}this._map=t}function v(){}function x(e){this._headers=e}function j(){}function M(){this._listeners=Object.create(null)}function C(e){t(function(){throw e},0)}function S(e){this.type=e,this.target=void 0}function T(e,t){S.call(this,e),this.data=t.data,this.lastEventId=t.lastEventId}function D(e,t){S.call(this,e),this.status=t.status,this.statusText=t.statusText,this.headers=t.headers}function k(e,t){S.call(this,e),this.error=t.error}y.prototype.open=function(e,a){this._abort(!0);var o=this,i=this._xhr,s=1,c=0;this._abort=function(e){0!==o._sendTimeout&&(n(o._sendTimeout),o._sendTimeout=0),1!==s&&2!==s&&3!==s||(s=4,i.onload=p,i.onerror=p,i.onabort=p,i.onprogress=p,i.onreadystatechange=p,i.abort(),0!==c&&(n(c),c=0),e||(o.readyState=4,o.onabort(null),o.onreadystatechange())),s=0};var u=function(){if(1===s){var e=0,t="",n=void 0;if("contentType"in i)e=200,t="OK",n=i.contentType;else try{e=i.status,t=i.statusText,n=i.getResponseHeader("Content-Type")}catch(r){e=0,t="",n=void 0}0!==e&&(s=2,o.readyState=2,o.status=e,o.statusText=t,o._contentType=n,o.onreadystatechange())}},d=function(){if(u(),2===s||3===s){s=3;var e="";try{e=i.responseText}catch(t){}o.readyState=3,o.responseText=e,o.onprogress()}},l=function(e,t){if(null!=t&&null!=t.preventDefault||(t={preventDefault:p}),d(),1===s||2===s||3===s){if(s=4,0!==c&&(n(c),c=0),o.readyState=4,"load"===e)o.onload(t);else if("error"===e)o.onerror(t);else{if("abort"!==e)throw new TypeError;o.onabort(t)}o.onreadystatechange()}},h=function(){c=t(function(){h()},500),3===i.readyState&&d()};"onload"in i&&(i.onload=function(e){l("load",e)}),"onerror"in i&&(i.onerror=function(e){l("error",e)}),"onabort"in i&&(i.onabort=function(e){l("abort",e)}),"onprogress"in i&&(i.onprogress=d),"onreadystatechange"in i&&(i.onreadystatechange=function(e){!function(e){null!=i&&(4===i.readyState?"onload"in i&&"onerror"in i&&"onabort"in i||l(""===i.responseText?"error":"load",e):3===i.readyState?"onprogress"in i||d():2===i.readyState&&u())}(e)}),!("contentType"in i)&&"ontimeout"in r.prototype||(a+=(-1===a.indexOf("?")?"?":"&")+"padding=true"),i.open(e,a,!0),"readyState"in i&&(c=t(function(){h()},0))},y.prototype.abort=function(){this._abort(!1)},y.prototype.getResponseHeader=function(e){return this._contentType},y.prototype.setRequestHeader=function(e,t){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,t)},y.prototype.getAllResponseHeaders=function(){return null!=this._xhr.getAllResponseHeaders&&this._xhr.getAllResponseHeaders()||""},y.prototype.send=function(){if("ontimeout"in r.prototype&&("sendAsBinary"in r.prototype||"mozAnon"in r.prototype)||null==s||null==s.readyState||"complete"===s.readyState){var e=this._xhr;"withCredentials"in e&&(e.withCredentials=this.withCredentials);try{e.send(void 0)}catch(a){throw a}}else{var n=this;n._sendTimeout=t(function(){n._sendTimeout=0,n.send()},4)}},b.prototype.get=function(e){return this._map[w(e)]},null!=r&&null==r.HEADERS_RECEIVED&&(r.HEADERS_RECEIVED=2),v.prototype.open=function(e,t,n,a,o,i,s){e.open("GET",o);var c=0;for(var u in e.onprogress=function(){var t=e.responseText.slice(c);c+=t.length,n(t)},e.onerror=function(e){e.preventDefault(),a(new Error("NetworkError"))},e.onload=function(){a(null)},e.onabort=function(){a(null)},e.onreadystatechange=function(){if(e.readyState===r.HEADERS_RECEIVED){var n=e.status,a=e.statusText,o=e.getResponseHeader("Content-Type"),i=e.getAllResponseHeaders();t(n,a,o,new b(i))}},e.withCredentials=i,s)Object.prototype.hasOwnProperty.call(s,u)&&e.setRequestHeader(u,s[u]);return e.send(),e},x.prototype.get=function(e){return this._headers.get(e)},j.prototype.open=function(e,t,n,r,a,o,i){var s=null,d=new f,h=d.signal,m=new l;return u(a,{headers:i,credentials:o?"include":"same-origin",signal:h,cache:"no-store"}).then(function(e){return s=e.body.getReader(),t(e.status,e.statusText,e.headers.get("Content-Type"),new x(e.headers)),new c(function(e,t){var r=function(){s.read().then(function(t){if(t.done)e(void 0);else{var a=m.decode(t.value,{stream:!0});n(a),r()}}).catch(function(e){t(e)})};r()})}).catch(function(e){return"AbortError"===e.name?void 0:e}).then(function(e){r(e)}),{abort:function(){null!=s&&s.cancel(),d.abort()}}},M.prototype.dispatchEvent=function(e){e.target=this;var t=this._listeners[e.type];if(null!=t)for(var n=t.length,r=0;r<n;r+=1){var a=t[r];try{"function"==typeof a.handleEvent?a.handleEvent(e):a.call(this,e)}catch(o){C(o)}}},M.prototype.addEventListener=function(e,t){e=String(e);var n=this._listeners,r=n[e];null==r&&(r=[],n[e]=r);for(var a=!1,o=0;o<r.length;o+=1)r[o]===t&&(a=!0);a||r.push(t)},M.prototype.removeEventListener=function(e,t){e=String(e);var n=this._listeners,r=n[e];if(null!=r){for(var a=[],o=0;o<r.length;o+=1)r[o]!==t&&a.push(r[o]);0===a.length?delete n[e]:n[e]=a}},T.prototype=Object.create(S.prototype),D.prototype=Object.create(S.prototype),k.prototype=Object.create(S.prototype);var P=-1,E=-1,W=/^text\/event\-stream(;.*)?$/i,N=function(e,t){var n=null==e?t:parseInt(e,10);return n!=n&&(n=t),O(n)},O=function(e){return Math.min(Math.max(e,1e3),18e6)},A=function(e,t,n){try{"function"==typeof t&&t.call(e,n)}catch(r){C(r)}};function _(e,o){M.call(this),o=o||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,function(e,o,i){o=String(o);var s=Boolean(i.withCredentials),c=i.lastEventIdQueryParameterName||"lastEventId",u=O(1e3),d=N(i.heartbeatTimeout,45e3),l="",h=u,f=!1,m=0,g=i.headers||{},p=i.Transport,w=I&&null==p?void 0:new y(null!=p?new p:null!=r&&"withCredentials"in r.prototype||null==a?new r:new a),b=null!=p&&"string"!=typeof p?new p:null==w?new j:new v,x=void 0,M=0,C=P,S="",R="",H="",_="",z=0,Y=0,q=0,L=function(t,n,r,a){if(0===C)if(200===t&&null!=r&&W.test(r)){C=1,f=Date.now(),h=u,e.readyState=1;var o=new D("open",{status:t,statusText:n,headers:a});e.dispatchEvent(o),A(e,e.onopen,o)}else 200!==t?n&&(n=n.replace(/\s+/g," ")):null==r||r.replace(/\s+/g," "),X(),o=new D("error",{status:t,statusText:n,headers:a}),e.dispatchEvent(o),A(e,e.onerror,o)},B=function(r){if(1===C){for(var a=-1,o=0;o<r.length;o+=1)(c=r.charCodeAt(o))!=="\n".charCodeAt(0)&&c!=="\r".charCodeAt(0)||(a=o);var i=(-1!==a?_:"")+r.slice(0,a+1);_=(-1===a?_:"")+r.slice(a+1),""!==r&&(f=Date.now(),m+=r.length);for(var s=0;s<i.length;s+=1){var c=i.charCodeAt(s);if(z===E&&c==="\n".charCodeAt(0))z=0;else if(z===E&&(z=0),c==="\r".charCodeAt(0)||c==="\n".charCodeAt(0)){if(0!==z){1===z&&(q=s+1);var g=i.slice(Y,q-1),p=i.slice(q+(q<s&&i.charCodeAt(q)===" ".charCodeAt(0)?1:0),s);"data"===g?(S+="\n",S+=p):"id"===g?R=p:"event"===g?H=p:"retry"===g?(u=N(p,u),h=u):"heartbeatTimeout"===g&&(d=N(p,d),0!==M&&(n(M),M=t(function(){U()},d)))}if(0===z){if(""!==S){l=R,""===H&&(H="message");var y=new T(H,{data:S.slice(1),lastEventId:R});if(e.dispatchEvent(y),"open"===H?A(e,e.onopen,y):"message"===H?A(e,e.onmessage,y):"error"===H&&A(e,e.onerror,y),2===C)return}S="",H=""}z=c==="\r".charCodeAt(0)?E:0}else 0===z&&(Y=s,z=1),1===z?c===":".charCodeAt(0)&&(q=s+1,z=2):2===z&&(z=3)}}},F=function(r){if(1===C||0===C){C=P,0!==M&&(n(M),M=0),M=t(function(){U()},h),h=O(Math.min(16*u,2*h)),e.readyState=0;var a=new k("error",{error:r});e.dispatchEvent(a),A(e,e.onerror,a)}},X=function(){C=2,null!=x&&(x.abort(),x=void 0),0!==M&&(n(M),M=0),e.readyState=2},U=function(){if(M=0,C===P){f=!1,m=0,M=t(function(){U()},d),C=0,S="",H="",R=l,_="",Y=0,q=0,z=0;var n=o;if("data:"!==o.slice(0,5)&&"blob:"!==o.slice(0,5)&&""!==l){var r=o.indexOf("?");n=-1===r?o:o.slice(0,r+1)+o.slice(r+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(e,t){return t===c?"":e}),n+=(-1===o.indexOf("?")?"?":"&")+c+"="+encodeURIComponent(l)}var a=e.withCredentials,i={Accept:"text/event-stream"},s=e.headers;if(null!=s)for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(i[u]=s[u]);try{x=b.open(w,L,B,F,n,a,i)}catch(g){throw X(),g}}else if(f||null==x){var h=Math.max((f||Date.now())+d-Date.now(),1);f=!1,M=t(function(){U()},h)}else F(new Error("No activity within "+d+" milliseconds. "+(0===C?"No response received.":m+" chars received.")+" Reconnecting.")),null!=x&&(x.abort(),x=void 0)};e.url=o,e.readyState=0,e.withCredentials=s,e.headers=g,e._close=X,U()}(this,e,o)}var I=null!=u&&null!=d&&"body"in d.prototype;_.prototype=Object.create(M.prototype),_.prototype.CONNECTING=0,_.prototype.OPEN=1,_.prototype.CLOSED=2,_.prototype.close=function(){this._close()},_.CONNECTING=0,_.OPEN=1,_.CLOSED=2,_.prototype.withCredentials=void 0;var z,Y,q=i;null==r||null!=i&&"withCredentials"in i.prototype||(q=_),(z=H).EventSourcePolyfill=_,z.NativeEventSource=i,void 0!==(Y=void(z.EventSource=q))&&(R.exports=Y)}("undefined"==typeof globalThis?"undefined"!=typeof window?window:"undefined"!=typeof self?self:W.exports:globalThis)),W.exports);const O=(e,t)=>{const n=e.findIndex(e=>e.id===t.id);if(-1!==n){const r=[...e];return r[n]={...r[n],...t},r}return[...e,t].sort((e,t)=>(e.fecha?new Date(e.fecha):new Date(0))-(t.fecha?new Date(t.fecha):new Date(0)))},A=(t,n)=>{const[r,a]=e.useState([]),[o,i]=e.useState(!0),[s,c]=e.useState(null),[u,d]=e.useState(!1),[l,h]=e.useState(null),[f,m]=e.useState(!0),g=e.useRef(null),p=e.useRef(0),y=e.useRef(null),w=e.useRef(null),b=e.useRef(!1),v=e.useRef((()=>{const e=M.defaults.baseURL||"/",t=e.endsWith("/")?e:`${e}/`;try{return new URL(t,window.location.origin).toString()}catch(n){return window.location.origin}})()),x=e.useCallback(async()=>{if(t)try{i(!0),c(null);const e=await M.get(C.mensajes(t),{params:{limit:50,ordering:"-enviado_en"}});if(!l){const e=await M.get(S.USER);h(e.data.id)}const n=[...e.data.map(e=>({...e,fecha:e.fecha||e.enviado_en}))].sort((e,t)=>(e.fecha?new Date(e.fecha):new Date(0))-(t.fecha?new Date(t.fecha):new Date(0)));a(n),n.length>0&&(p.current=n[n.length-1].id)}catch(e){404===e.response?.status?(c(null),a([])):c(e.response?.data?.detail||"Error al cargar mensajes")}finally{i(!1)}},[t,l]),j=e.useCallback(async e=>{if(t&&e.trim())try{d(!0);const n=await M.post(C.enviarMensaje(t),{contenido:e.trim()}),r={...n.data,fecha:n.data.fecha||n.data.enviado_en};return a(e=>O(e,r)),r}catch(r){if(n){const e=r.response?.data?.detail||"Error al enviar el mensaje. Por favor, intenta de nuevo.";n(e)}throw r}finally{d(!1)}},[t,n]),T=e.useCallback(()=>{if(t&&b.current){g.current&&g.current.close();try{const e=localStorage.getItem("skillswap_token");if(!e)return void m(!1);const n=C.stream(t,p.current),r=new URL(n,v.current).toString();g.current=new N.EventSourcePolyfill(r,{headers:{Authorization:`Token ${e}`},withCredentials:!0}),g.current.onmessage=e=>{try{const t=JSON.parse(e.data),n={...t,fecha:t.fecha||t.enviado_en};a(e=>O(e,n)),p.current=t.id}catch(t){}},g.current.onerror=e=>{g.current.close(),m(!1)}}catch(e){}}},[t]),D=e.useCallback(()=>{t&&(w.current=setInterval(async()=>{try{const e=await M.get(C.mensajes(t),{params:{limit:50,ordering:"-enviado_en"}}),n=[...e.data.map(e=>({...e,fecha:e.fecha||e.enviado_en}))].sort((e,t)=>(e.fecha?new Date(e.fecha):new Date(0))-(t.fecha?new Date(t.fecha):new Date(0)));a(e=>{let t=e;return n.forEach(e=>{t=O(t,e)}),t})}catch(e){}},3e4))},[t]),k=e.useCallback(async()=>{if(t&&l)try{a(e=>e.map(e=>({...e,leido:("object"==typeof e.remitente?e.remitente.id:e.remitente)!==l||e.leido})))}catch(e){}},[t,l,r]),P=e.useCallback(async e=>{try{await M.delete(C.eliminarMensaje(t,e)),a(t=>t.filter(t=>t.id!==e))}catch(n){throw n}},[]);return e.useEffect(()=>(p.current=0,b.current=!1,m(!0),t?x().then(()=>{b.current=!0,T()}):(a([]),i(!1)),()=>{g.current&&g.current.close(),y.current&&clearTimeout(y.current),w.current&&clearInterval(w.current)}),[t,x,T]),e.useEffect(()=>{if(!f&&t)return D(),()=>{w.current&&clearInterval(w.current)}},[f,t,D]),e.useEffect(()=>{r.length>0&&l&&k()},[r.length,l]),{messages:r,loading:o,error:s,sending:u,currentUserId:l,sendMessage:j,deleteMessage:P,fetchInitialMessages:x}},_=(t,n)=>{const r=e.useRef(null),a=e.useRef(null),o=e.useRef(!0),i=e.useRef(0),s=e.useRef(!1),c=e.useRef(0),u=e.useRef(!0),d=e.useRef(!0),l=()=>{r.current&&setTimeout(()=>{if(r.current){const e=r.current.scrollHeight;r.current.scrollTop=e,c.current=e,u.current=!0}},0)};return e.useEffect(()=>{o.current&&t.length>0&&!n&&r.current&&(o.current=!1,s.current=!0,l())},[t.length,n]),e.useEffect(()=>{s.current&&r.current&&c.current>0&&(0===r.current.scrollTop&&r.current.scrollHeight>100?r.current.scrollTop=c.current:r.current.scrollTop!==c.current&&(c.current=r.current.scrollTop))},[t.length]),e.useEffect(()=>{!d.current&&t.length>i.current&&(u.current||0===i.current)&&l(),i.current=t.length},[t.length]),{messagesContainerRef:r,messagesEndRef:a,handleScroll:()=>{u.current=(()=>{if(!r.current)return!1;const{scrollHeight:e,clientHeight:t,scrollTop:n}=r.current;return e-(n+t)<50})()},scrollToBottom:l,resetScrollState:()=>{d.current=!0,o.current=!0,i.current=0,s.current=!1,c.current=0,u.current=!0},isInitialLoadRef:d}},I=6048e5,z=Symbol.for("constructDateFrom");function Y(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&z in e?e[z](t):e instanceof Date?new e.constructor(t):new Date(t)}function q(e,t){return Y(t||e,e)}let L={};function B(){return L}function F(e,t){const n=B(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,a=q(e,t?.in),o=a.getDay(),i=(o<r?7:0)+o-r;return a.setDate(a.getDate()-i),a.setHours(0,0,0,0),a}function X(e,t){return F(e,{...t,weekStartsOn:1})}function U(e,t){const n=q(e,t?.in),r=n.getFullYear(),a=Y(n,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const o=X(a),i=Y(n,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const s=X(i);return n.getTime()>=o.getTime()?r+1:n.getTime()>=s.getTime()?r:r-1}function G(e){const t=q(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Q(e,...t){const n=Y.bind(null,t.find(e=>"object"==typeof e));return t.map(n)}function $(e,t){const n=q(e,t?.in);return n.setHours(0,0,0,0),n}function K(e){return Y(e,Date.now())}function J(e,t,n){const[r,a]=Q(0,e,t);return+$(r)===+$(a)}function V(e){return!(!((t=e)instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t))&&"number"!=typeof e||isNaN(+q(e)));var t}const Z={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ee(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const te={date:ee({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ee({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ee({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ne={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function re(e){return(t,n)=>{let r;if("formatting"===(n?.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,a=n?.width?String(n.width):t;r=e.formattingValues[a]||e.formattingValues[t]}else{const t=e.defaultWidth,a=n?.width?String(n.width):e.defaultWidth;r=e.values[a]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function ae(e){return(t,n={})=>{const r=n.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],o=t.match(a);if(!o)return null;const i=o[0],s=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(s)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(s,e=>e.test(i)):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(s,e=>e.test(i));let u;u=e.valueCallback?e.valueCallback(c):c,u=n.valueCallback?n.valueCallback(u):u;return{value:u,rest:t.slice(i.length)}}}function oe(e){return(t,n={})=>{const r=t.match(e.matchPattern);if(!r)return null;const a=r[0],o=t.match(e.parsePattern);if(!o)return null;let i=e.valueCallback?e.valueCallback(o[0]):o[0];i=n.valueCallback?n.valueCallback(i):i;return{value:i,rest:t.slice(a.length)}}}const ie={code:"en-US",formatDistance:(e,t,n)=>{let r;const a=Z[e];return r="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:te,formatRelative:(e,t,n,r)=>ne[e],localize:{ordinalNumber:(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:re({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:re({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:re({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:re({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:re({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:oe({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:ae({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ae({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:ae({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ae({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ae({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function se(e,t){const n=q(e,t?.in),r=function(e,t){const[n,r]=Q(0,e,t),a=$(n),o=$(r),i=+a-G(a),s=+o-G(o);return Math.round((i-s)/864e5)}(n,function(e,t){const n=q(e,t?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}(n));return r+1}function ce(e,t){const n=q(e,t?.in),r=+X(n)-+function(e,t){const n=U(e,t),r=Y(e,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),X(r)}(n);return Math.round(r/I)+1}function ue(e,t){const n=q(e,t?.in),r=n.getFullYear(),a=B(),o=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,i=Y(t?.in||e,0);i.setFullYear(r+1,0,o),i.setHours(0,0,0,0);const s=F(i,t),c=Y(t?.in||e,0);c.setFullYear(r,0,o),c.setHours(0,0,0,0);const u=F(c,t);return+n>=+s?r+1:+n>=+u?r:r-1}function de(e,t){const n=q(e,t?.in),r=+F(n,t)-+function(e,t){const n=B(),r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,a=ue(e,t),o=Y(t?.in||e,0);return o.setFullYear(a,0,r),o.setHours(0,0,0,0),F(o,t)}(n,t);return Math.round(r/I)+1}function le(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const he={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return le("yy"===t?r%100:r,t.length)},M(e,t){const n=e.getMonth();return"M"===t?String(n+1):le(n+1,2)},d:(e,t)=>le(e.getDate(),t.length),a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:(e,t)=>le(e.getHours()%12||12,t.length),H:(e,t)=>le(e.getHours(),t.length),m:(e,t)=>le(e.getMinutes(),t.length),s:(e,t)=>le(e.getSeconds(),t.length),S(e,t){const n=t.length,r=e.getMilliseconds();return le(Math.trunc(r*Math.pow(10,n-3)),t.length)}},fe="midnight",me="noon",ge="morning",pe="afternoon",ye="evening",we="night",be={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){const t=e.getFullYear(),r=t>0?t:1-t;return n.ordinalNumber(r,{unit:"year"})}return he.y(e,t)},Y:function(e,t,n,r){const a=ue(e,r),o=a>0?a:1-a;if("YY"===t){return le(o%100,2)}return"Yo"===t?n.ordinalNumber(o,{unit:"year"}):le(o,t.length)},R:function(e,t){return le(U(e),t.length)},u:function(e,t){return le(e.getFullYear(),t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return le(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return le(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return he.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return le(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const a=de(e,r);return"wo"===t?n.ordinalNumber(a,{unit:"week"}):le(a,t.length)},I:function(e,t,n){const r=ce(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):le(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getDate(),{unit:"date"}):he.d(e,t)},D:function(e,t,n){const r=se(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):le(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const a=e.getDay(),o=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return le(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const a=e.getDay(),o=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return le(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),a=0===r?7:r;switch(t){case"i":return String(a);case"ii":return le(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let a;switch(a=12===r?me:0===r?fe:r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let a;switch(a=r>=17?ye:r>=12?pe:r>=4?ge:we,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),n.ordinalNumber(t,{unit:"hour"})}return he.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getHours(),{unit:"hour"}):he.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):le(r,t.length)},k:function(e,t,n){let r=e.getHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):le(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):he.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getSeconds(),{unit:"second"}):he.s(e,t)},S:function(e,t){return he.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return xe(r);case"XXXX":case"XX":return je(r);default:return je(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return xe(r);case"xxxx":case"xx":return je(r);default:return je(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ve(r,":");default:return"GMT"+je(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ve(r,":");default:return"GMT"+je(r,":")}},t:function(e,t,n){return le(Math.trunc(+e/1e3),t.length)},T:function(e,t,n){return le(+e,t.length)}};function ve(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),o=r%60;return 0===o?n+String(a):n+String(a)+t+le(o,2)}function xe(e,t){if(e%60==0){return(e>0?"-":"+")+le(Math.abs(e)/60,2)}return je(e,t)}function je(e,t=""){const n=e>0?"-":"+",r=Math.abs(e);return n+le(Math.trunc(r/60),2)+t+le(r%60,2)}const Me=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Ce=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Se={p:Ce,P:(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],a=n[2];if(!a)return Me(e,t);let o;switch(r){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;default:o=t.dateTime({width:"full"})}return o.replace("{{date}}",Me(r,t)).replace("{{time}}",Ce(a,t))}},Te=/^D+$/,De=/^Y+$/,ke=["D","DD","YY","YYYY"];const Pe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ee=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,We=/^'([^]*?)'?$/,Re=/''/g,He=/[a-zA-Z]/;function Ne(e,t,n){const r=B(),a=n?.locale??r.locale??ie,o=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,i=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,s=q(e,n?.in);if(!V(s))throw new RangeError("Invalid time value");let c=t.match(Ee).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Se[t])(e,a.formatLong)}return e}).join("").match(Pe).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Oe(e)};if(be[t])return{isToken:!0,value:e};if(t.match(He))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});a.localize.preprocessor&&(c=a.localize.preprocessor(s,c));const u={firstWeekContainsDate:o,weekStartsOn:i,locale:a};return c.map(r=>{if(!r.isToken)return r.value;const o=r.value;(!n?.useAdditionalWeekYearTokens&&function(e){return De.test(e)}(o)||!n?.useAdditionalDayOfYearTokens&&function(e){return Te.test(e)}(o))&&function(e,t,n){const r=function(e,t,n){const r="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,n);if(ke.includes(e))throw new RangeError(r)}(o,t,String(e));return(0,be[o[0]])(s,o,a.localize,u)}).join("")}function Oe(e){const t=e.match(We);return t?t[1].replace(Re,"'"):e}function Ae(e,t){return J(Y(e,e),K(e))}function _e(e,t,n){return function(e,t,n){const r=q(e,n?.in);return isNaN(t)?Y(e,NaN):(r.setDate(r.getDate()+t),r)}(e,-1,n)}function Ie(e,t){return J(Y(e,e),_e(K(e)))}const ze={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},Ye={date:ee({formats:{full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:ee({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:ee({formats:{full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},qe={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},Le={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},Be={code:"es",formatDistance:(e,t,n)=>{let r;const a=ze[e];return r="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"en "+r:"hace "+r:r},formatLong:Ye,formatRelative:(e,t,n,r)=>1!==t.getHours()?Le[e]:qe[e],localize:{ordinalNumber:(e,t)=>Number(e)+"º",era:re({values:{narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},defaultWidth:"wide"}),quarter:re({values:{narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:re({values:{narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},defaultWidth:"wide"}),day:re({values:{narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},defaultWidth:"wide"}),dayPeriod:re({values:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:oe({matchPattern:/^(\d+)(º)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:ae({matchPatterns:{narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},defaultParseWidth:"any"}),quarter:ae({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:ae({matchPatterns:{narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},defaultParseWidth:"any"}),day:ae({matchPatterns:{narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ae({matchPatterns:{narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:1}},Fe=()=>({formatMessageDate:e=>{if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?"":Ae(t)?Ne(t,"HH:mm",{locale:Be}):Ie(t)?`Ayer ${Ne(t,"HH:mm",{locale:Be})}`:Ne(t,"dd/MM/yyyy HH:mm",{locale:Be})},groupMessagesByDate:e=>{const t={};return e.forEach(e=>{if(!e.fecha)return;const n=new Date(e.fecha);if(isNaN(n.getTime()))return;const r=(e=>Ae(e)?"Hoy":Ie(e)?"Ayer":Ne(e,"dd MMMM yyyy",{locale:Be}))(n);t[r]||(t[r]=[]),t[r].push(e)}),Object.entries(t).map(([e,t])=>({dateKey:e,messages:t}))}}),Xe=e.memo(({otherUser:e,onBack:r})=>t.jsxs(y,{elevation:1,sx:{p:2,display:"flex",alignItems:"center",gap:2,borderRadius:0},children:[r&&t.jsx(w,{onClick:r,size:"small",children:"←"}),e?t.jsxs(t.Fragment,{children:[t.jsx(g,{src:e?.media||e?.foto_perfil,alt:`${e?.nombre||""} ${e?.apellido||""}`,children:e?.nombre?.[0]?.toUpperCase()||"?"}),t.jsxs(n,{children:[t.jsxs(i,{variant:"subtitle1",fontWeight:"bold",children:[e?.nombre," ",e?.apellido]}),t.jsx(i,{variant:"body2",color:"text.secondary",children:e?.email})]})]}):t.jsx(i,{variant:"subtitle1",fontWeight:"bold",children:"Conversación"})]}));Xe.displayName="ChatHeader";const Ue=e.memo(({dateKey:e})=>t.jsx(n,{display:"flex",justifyContent:"center",my:2,children:t.jsx(i,{variant:"caption",color:"text.secondary",sx:{bgcolor:"background.paper",px:2,py:.5,borderRadius:2},children:e})}));Ue.displayName="DateDivider";const Ge=e.memo(({message:e,isOwnMessage:r,formatMessageDate:a})=>t.jsx(n,{sx:{display:"flex",justifyContent:r?"flex-end":"flex-start",mb:1},children:t.jsxs(y,{elevation:1,sx:{p:1.5,maxWidth:"70%",bgcolor:r?"primary.main":"background.paper",color:r?"primary.contrastText":"text.primary",borderRadius:2,borderBottomRightRadius:r?4:16,borderBottomLeftRadius:r?16:4},children:[t.jsx(i,{variant:"body1",sx:{wordBreak:"break-word",whiteSpace:"pre-wrap"},children:e.contenido}),t.jsx(i,{variant:"caption",sx:{display:"block",textAlign:"right",mt:.5,opacity:.8},children:a(e.fecha)})]})}),(e,t)=>e.message.id===t.message.id&&e.isOwnMessage===t.isOwnMessage&&e.message.contenido===t.message.contenido&&e.message.fecha===t.message.fecha);Ge.displayName="MessageBubble";const Qe=({messages:e,currentUserId:r,formatMessageDate:a,containerRef:o,onScroll:i,endRef:s})=>0===e.length?t.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:"No hay mensajes"}):t.jsxs(n,{ref:o,onScroll:i,sx:{flex:1,overflow:"auto",p:2,display:"flex",flexDirection:"column",gap:1},children:[e.map(e=>t.jsxs(n,{children:[t.jsx(Ue,{dateKey:e.dateKey}),e.messages.map(e=>{const n=("object"==typeof e.remitente?e.remitente.id:e.remitente)===r;return t.jsx(Ge,{message:e,isOwnMessage:n,formatMessageDate:a},e.id)})]},e.dateKey)),t.jsx("div",{ref:s})]}),$e=e.memo(({value:e,onChange:n,onSubmit:a,onKeyPress:o,disabled:i})=>t.jsxs(y,{component:"form",onSubmit:a,sx:{p:2,display:"flex",gap:1,borderRadius:0},elevation:3,children:[t.jsx(s,{id:"message-input",name:"message-input",fullWidth:!0,multiline:!0,maxRows:4,placeholder:"Escribe un mensaje...",value:e,onChange:n,onKeyPress:o,disabled:i,variant:"outlined",size:"small"}),t.jsx(w,{color:"primary",type:"submit",disabled:!e.trim()||i,sx:{alignSelf:"flex-end"},children:i?t.jsx(r,{size:24}):t.jsx(j,{})})]}));$e.displayName="MessageInput";const Ke=({state:e="empty"})=>{const a={empty:"No hay mensajes aún. ¡Envía el primero!",noConversation:"Selecciona una conversación para empezar a chatear",error:"Error al cargar los mensajes"};return"loading"===e?t.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:t.jsx(r,{})}):t.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:t.jsx(i,{color:"text.secondary",children:a[e]||a.empty})})},Je=({conversationId:r,otherUser:a,onBack:o})=>{const{showToast:i}=T(),s=e.useCallback(e=>{i(e,"error",5e3)},[i]),{messages:c,loading:u,error:l,sending:h,currentUserId:f,sendMessage:m}=A(r,s),{messagesContainerRef:g,messagesEndRef:p,handleScroll:y,scrollToBottom:w,resetScrollState:b}=_(c,u),{formatMessageDate:v,groupMessagesByDate:x}=Fe(),{messageInput:j,handleSendMessage:M,handleKeyPress:C,handleInputChange:S}=((t,n)=>{const[r,a]=e.useState(""),o=async e=>{if(e.preventDefault(),r.trim())try{await t(r),a(""),n?.()}catch(l){}};return{messageInput:r,setMessageInput:a,handleSendMessage:o,handleKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o(e))},handleInputChange:e=>{a(e.target.value)}}})(m,w);if(e.useEffect(()=>{b()},[r,b]),!r)return t.jsx(n,{sx:{height:"100%",display:"flex",bgcolor:"grey.50"},children:t.jsx(Ke,{state:"noConversation"})});if(u&&0===c.length)return t.jsx(n,{sx:{height:"100%",display:"flex"},children:t.jsx(Ke,{state:"loading"})});if(l)return t.jsx(n,{sx:{height:"100%",display:"flex"},children:t.jsx(Ke,{state:"error"})});const D=x(c);return t.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column",bgcolor:"grey.50"},children:[t.jsx(Xe,{otherUser:a,onBack:o}),t.jsx(Qe,{messages:D,currentUserId:f,formatMessageDate:v,containerRef:g,onScroll:y,endRef:p}),t.jsx(d,{}),t.jsx($e,{value:j,onChange:S,onSubmit:M,onKeyPress:C,disabled:h})]})};function Ve(){const a=b(),o=v(a.breakpoints.down("md")),{conversacionId:i}=k(),s=i?Number(i):null,[c,u]=e.useState(s),{conversations:d,loading:l,error:h,fetchConversations:f}=D(),m=e.useMemo(()=>d.find(e=>String(e.id)===String(c)),[d,c]);return t.jsxs(n,{sx:{display:"flex",height:"calc(100vh - 100px)",gap:1,p:2,backgroundColor:"#f5f5f5"},children:[t.jsx(y,{sx:{flex:o?c?0:1:"0 0 320px",display:o&&c?"none":"flex",flexDirection:"column",overflow:"hidden"},children:t.jsx(e.Suspense,{fallback:t.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(r,{})}),children:t.jsx(P,{conversations:d,loading:l,error:h,onSelectConversation:e=>{u(e)},onRetry:f,selectedConversationId:c})})}),c&&t.jsx(y,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:t.jsx(e.Suspense,{fallback:t.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsx(r,{})}),children:t.jsx(Je,{conversationId:c,otherUser:m?.otherUser,onBack:o?()=>u(null):void 0})})}),!c&&!o&&t.jsx(y,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(n,{sx:{textAlign:"center",color:"text.secondary"},children:"Selecciona una conversación para empezar a chatear"})})]})}export{Ve as default};
