import{r as e,R as s,j as a,q as r,s as t,k as n,x as i,B as l,T as o,u as c,y as d,d as x,C as m,m as h,n as u,o as p,z as j}from"./mui-core-BpoTvZsj.js";import{a as g,C as f,P as b,R as y,S as C}from"./mui-icons-Bcg_AGA-.js";import{c as v,A as w,U as A,b as z,R as _}from"../index-BF7ALLnG.js";import{f as S,e as k}from"./skillsCache-DM44Hx6q.js";import{u as R}from"./useConversations-CdxEXnnV.js";import{b as E}from"./vendor-47kkluUf.js";import"./http-Dos3PyFQ.js";const I=s.memo(({friend:s})=>{const h=E(),{getOrCreateConversation:u}=R(),{showToast:p}=z(),[j,b]=e.useState(!1),{id:y,nombre:C="Usuario",apellido:v="",email:w="",media:A,foto_perfil:S,habilidades_ofrecer:k=[],habilidades_aprender:I=[]}=s,P=A||S,B=e.useCallback(()=>{h(_.USUARIO_BY_ID(y))},[y,h]),L=e.useCallback(async()=>{try{b(!0);const e=await u(y);h(_.CHAT_CONVERSACION(e.id))}catch(e){p("No se pudo abrir el chat. Intenta de nuevo.","error")}finally{b(!1)}},[y,h,u,p]),N=e=>e?.nombre||e?.name||e||"";return a.jsxs(r,{sx:{mb:2,"&:hover":{boxShadow:3,transform:"translateY(-2px)",transition:"all 0.2s"}},children:[a.jsx(t,{children:a.jsxs(n,{direction:"row",spacing:2,alignItems:"flex-start",children:[a.jsx(i,{src:P,alt:`${C} ${v}`,sx:{width:60,height:60},children:!P&&a.jsx(g,{})}),a.jsxs(l,{sx:{flex:1},children:[a.jsxs(o,{variant:"h6",gutterBottom:!0,children:[C," ",v]}),a.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:w}),k.length>0&&a.jsxs(l,{sx:{mb:1},children:[a.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Puede enseñar:"}),a.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[k.slice(0,3).map((e,s)=>a.jsx(c,{label:N(e),size:"small",color:"primary",variant:"outlined",sx:{mt:.5}},e?.id||e?.nombre||e?.name||s)),k.length>3&&a.jsx(c,{label:"+"+(k.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),I.length>0&&a.jsxs(l,{children:[a.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Quiere aprender:"}),a.jsxs(n,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[I.slice(0,3).map((e,s)=>a.jsx(c,{label:N(e),size:"small",color:"secondary",variant:"outlined",sx:{mt:.5}},e?.id||e?.nombre||e?.name||s)),I.length>3&&a.jsx(c,{label:"+"+(I.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]})]})]})}),a.jsxs(d,{sx:{justifyContent:"flex-end",px:2,pb:2},children:[a.jsx(x,{size:"small",onClick:B,children:"Ver Perfil"}),a.jsx(x,{variant:"contained",color:"primary",startIcon:j?a.jsx(m,{size:16,color:"inherit"}):a.jsx(f,{}),onClick:L,size:"small",disabled:j,children:j?"Abriendo...":"Chatear"})]})]})}),P=()=>{const{friends:s,loading:r,error:t,fetchFriends:i}=(()=>{const[s,a]=e.useState([]),[r,t]=e.useState(!1),[n,i]=e.useState(null),l=e.useRef(!0),o=e.useRef(null),c=e.useCallback(async()=>{try{t(!0),i(null),o.current&&o.current.abort();const e=new AbortController;o.current=e;const[s,r]=await Promise.all([v.get(w.USER,{signal:e.signal}),S()]),n=s.data.id,c=(await v.get(A.detalle(n),{signal:e.signal})).data.matches||[],d=[...new Set(c)];if(0===d.length)return l.current&&(a([]),i(null)),void t(!1);const x=(await Promise.all(d.map(async s=>{try{const a=(await v.get(A.detalle(s),{signal:e.signal})).data;return{...a,habilidades_ofrecer:k(a.habilidades_que_se_saben,r),habilidades_aprender:k(a.habilidades_por_aprender,r)}}catch(a){return null}}))).filter(e=>null!==e);l.current&&(a(x),i(null))}catch(e){if("CanceledError"===e?.name||"ERR_CANCELED"===e?.code)return;const s=e.response?.data?.message||"Error al cargar amigos";l.current&&i(s)}finally{l.current&&t(!1)}},[]);return e.useEffect(()=>(l.current=!0,c(),()=>{l.current=!1,o.current&&o.current.abort()}),[c]),{friends:s,loading:r,error:n,fetchFriends:c}})(),{showToast:c}=z(),[d,g]=e.useState("");e.useEffect(()=>{t&&c(t,"error")},[t,c]);const f=d.trim().toLowerCase(),_=s.filter(e=>{const s=(e.nombre||"").toLowerCase(),a=(e.apellido||"").toLowerCase(),r=(e.email||"").toLowerCase();return`${s} ${a}`.trim().includes(f)||r.includes(f)});return r&&0===s.length?a.jsx(l,{sx:{display:"flex",justifyContent:"center",py:8},children:a.jsx(m,{})}):a.jsxs(h,{maxWidth:"md",sx:{py:4},children:[a.jsxs(n,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,mb:3,children:[a.jsx(b,{sx:{fontSize:40,color:"primary.main"}}),a.jsxs(l,{sx:{flex:1,ml:1},children:[a.jsx(o,{variant:"h4",fontWeight:"bold",children:"Mis Amigos"}),a.jsxs(o,{variant:"body2",color:"text.secondary",children:[s.length," ",1===s.length?"amigo":"amigos"]})]}),a.jsx(x,{variant:"outlined",startIcon:r?a.jsx(m,{size:16}):a.jsx(y,{}),onClick:i,disabled:r,children:r?"Actualizando…":"Actualizar"})]}),s.length>0&&a.jsx(u,{fullWidth:!0,placeholder:"Buscar por nombre o email...",value:d,onChange:e=>g(e.target.value),sx:{mb:3},InputProps:{startAdornment:a.jsx(p,{position:"start",children:a.jsx(C,{})})}}),0===s.length?a.jsxs(j,{sx:{p:6,textAlign:"center"},children:[a.jsx(b,{sx:{fontSize:64,color:"text.secondary",mb:2}}),a.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aún no tienes amigos"}),a.jsx(o,{variant:"body2",color:"text.secondary",children:"Acepta solicitudes de match para empezar a conectar con otros usuarios"})]}):0===_.length?a.jsx(j,{sx:{p:4,textAlign:"center"},children:a.jsxs(o,{variant:"body1",color:"text.secondary",children:['No se encontraron amigos con "',d,'"']})}):a.jsx(l,{children:_.map(e=>a.jsx(I,{friend:e},e.id))})]})};export{P as default};
