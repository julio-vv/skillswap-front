import{r as e,R as r,j as s,q as a,s as t,G as n,x as o,B as i,T as l,k as c,u as d,I as u,m as h,n as x,o as m,C as p,A as b,P as j}from"./mui-core-BpoTvZsj.js";import{i as g,S as y}from"./mui-icons-58CkGrMT.js";import{c as f,U as S,R as _}from"../index-DnYbmb9J.js";import{u as v}from"./useErrorHandler-DVQpOzEU.js";import{b as C}from"./vendor-47kkluUf.js";import{f as w}from"./skillsCache-DrFCtLmv.js";import"./http-Dos3PyFQ.js";const k=(r=500)=>{const[s,a]=e.useState(""),[t,n]=e.useState([]),[o,i]=e.useState(!1),[l,c]=e.useState(!1),[d,u]=e.useState(1),[h,x]=e.useState(0),[m]=e.useState(10),{error:p,handleError:b,clearError:j}=v(),g=((r,s=500)=>{const[a,t]=e.useState(r);return e.useEffect(()=>{const e=setTimeout(()=>{t(r)},s);return()=>{clearTimeout(e)}},[r,s]),a})(s,r),y=e.useRef(null),_=e.useRef(!0),C=e.useCallback(async(e,r=1)=>{if(!e||e.trim().length<2)return n([]),c(!1),void x(0);y.current&&y.current.abort(),y.current=new AbortController,i(!0),j(),c(!0);try{const s=await f.get(S.buscar(e,r),{signal:y.current.signal});if(!_.current)return;if(s.data.results)n(s.data.results),x(s.data.count||0);else{const e=Array.isArray(s.data)?s.data:[];n(e),x(e.length)}}catch(s){"AbortError"!==s.name&&_.current&&(b(s,"búsqueda de usuarios"),n([]),x(0))}finally{_.current&&i(!1)}},[j,b]),w=e.useCallback(e=>{u(e),C(s,e)},[s,C]),k=e.useCallback(()=>{a(""),n([]),c(!1),u(1),x(0),j()},[j]),A=e.useMemo(()=>Math.ceil(h/m),[h,m]);return e.useEffect(()=>{if(g.trim().length<2)return n([]),c(!1),u(1),void x(0);u(1),C(g,1)},[g,C]),e.useEffect(()=>(_.current=!0,()=>{_.current=!1,y.current&&y.current.abort()}),[]),{searchQuery:s,setSearchQuery:a,searchResults:t,isLoading:o,error:p,hasSearched:l,currentPage:d,totalCount:h,pageSize:m,handlePageChange:w,resetSearch:k,totalPages:A}},A=(e,r=new Map)=>{if(e&&"object"==typeof e)return e.nombre_habilidad||e.nombre||String(e.id);return r.get(String(e))||String(e)},z=(e,r=new Map)=>Array.isArray(e)?e.map((e,s)=>({id:"object"==typeof e?e.id:e,nombre:A(e,r),_displayKey:s})):[],M=r.memo(({user:r,skillsMap:h=new Map,hideButton:x=!1,onCustomAction:m})=>{const p=C(),{id:b,nombre:j="Usuario",apellido:y="",email:f="",media:S,foto_perfil:v,habilidades_que_se_saben:w=[],habilidades_por_aprender:k=[]}=r,A=S||v,M=e.useMemo(()=>z(w,h),[w,h]),E=e.useMemo(()=>z(k,h),[k,h]),B=e.useCallback(()=>{m?m(b):p(_.USUARIO_BY_ID(b))},[b,p,m]),P=e.useCallback(e=>{e.stopPropagation(),B()},[B]);return s.jsx(a,{sx:{cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:3}},onClick:B,children:s.jsx(t,{children:s.jsxs(n,{container:!0,spacing:2,alignItems:"center",children:[s.jsxs(n,{size:{xs:12,md:4},sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(o,{src:A,alt:j,sx:{width:60,height:60,flexShrink:0},children:j?.charAt(0).toUpperCase()}),s.jsxs(i,{sx:{minWidth:0},children:[s.jsxs(l,{variant:"h6",noWrap:!0,children:[j," ",y]}),s.jsx(l,{variant:"body2",color:"text.secondary",noWrap:!0,children:f})]})]}),s.jsxs(n,{size:{xs:12,md:4},children:[s.jsx(l,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Sabe enseñar"}),M.length>0?s.jsxs(c,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[M.slice(0,3).map(e=>s.jsx(d,{label:e.nombre,size:"small",variant:"outlined"},e._displayKey)),M.length>3&&s.jsx(d,{label:"+"+(M.length-3),size:"small",variant:"outlined"})]}):s.jsx(l,{variant:"body2",color:"text.secondary",children:"Sin datos"})]}),s.jsxs(n,{size:{xs:12,md:3},children:[s.jsx(l,{variant:"subtitle2",color:"text.secondary",sx:{mb:.5},children:"Quiere aprender"}),E.length>0?s.jsxs(c,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[E.slice(0,3).map(e=>s.jsx(d,{label:e.nombre,size:"small",variant:"outlined"},e._displayKey)),E.length>3&&s.jsx(d,{label:"+"+(E.length-3),size:"small",variant:"outlined"})]}):s.jsx(l,{variant:"body2",color:"text.secondary",children:"Sin datos"})]}),!x&&s.jsx(n,{size:{xs:12,md:1},sx:{display:"flex",justifyContent:{xs:"flex-start",md:"flex-end"}},children:s.jsx(u,{color:"primary",onClick:P,size:"small",children:s.jsx(g,{})})})]})})})},(e,r)=>e.user.id===r.user.id&&e.user.nombre===r.user.nombre&&e.user.habilidades_que_se_saben?.length===r.user.habilidades_que_se_saben?.length&&e.user.habilidades_por_aprender?.length===r.user.habilidades_por_aprender?.length&&e.hideButton===r.hideButton);M.displayName="UserCard";const E=()=>{const{searchQuery:r,setSearchQuery:a,searchResults:t,isLoading:n,error:o,hasSearched:d,currentPage:u,totalCount:g,totalPages:f,handlePageChange:S}=k(),[_,v]=e.useState(new Map);e.useEffect(()=>{const e=new AbortController;return(async()=>{try{const e=await w();v(new Map(Object.entries(e)))}catch(e){e.name}})(),()=>{e.abort()}},[]);const C=e.useMemo(()=>{const e=new Map(_);return t.forEach(r=>{[...r.habilidades_que_se_saben||[],...r.habilidades_por_aprender||[]].forEach(r=>{if(r&&"object"==typeof r){const s=String(r.id),a=r.nombre_habilidad||r.nombre;s&&a&&!e.has(s)&&e.set(s,a)}})}),e},[t,_]),A=e.useCallback((e,r)=>{S(r),window.scrollTo({top:300,behavior:"smooth"})},[S]),z=e.useCallback(e=>{a(e.target.value)},[a]);return s.jsx(i,{sx:{bgcolor:"background.default",minHeight:"calc(100vh - 64px)"},children:s.jsxs(h,{maxWidth:"md",sx:{py:4},children:[s.jsx(l,{variant:"h4",component:"h1",sx:{mb:3,fontWeight:600},children:"Buscar Usuarios"}),s.jsx(x,{fullWidth:!0,placeholder:"Busca por nombre, apellido o habilidad...",value:r,onChange:z,InputProps:{startAdornment:s.jsx(m,{position:"start",children:s.jsx(y,{})}),endAdornment:n&&s.jsx(m,{position:"end",children:s.jsx(p,{size:20})})},sx:{mb:3}}),o&&s.jsx(b,{severity:"error",sx:{mb:2},children:o}),!d&&s.jsxs(i,{sx:{textAlign:"center",mt:8},children:[s.jsx(y,{sx:{fontSize:80,color:"text.secondary",mb:2}}),s.jsx(l,{variant:"h6",color:"text.secondary",children:"Escribe para buscar usuarios"}),s.jsx(l,{variant:"body2",color:"text.secondary",children:"Busca por nombre, apellido o habilidades"})]}),d&&!n&&0===t.length&&!o&&s.jsxs(i,{sx:{textAlign:"center",mt:8},children:[s.jsx(l,{variant:"h6",color:"text.secondary",children:"No se encontraron usuarios"}),s.jsx(l,{variant:"body2",color:"text.secondary",children:"Intenta con otros términos de búsqueda"})]}),d&&!n&&t.length>0&&s.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:g>0?`${g} usuario${1!==g?"s":""} encontrado${1!==g?"s":""}`:""}),s.jsx(c,{spacing:2,children:t.map(e=>s.jsx(M,{user:e,skillsMap:C},e.id))}),d&&!n&&t.length>0&&f>1&&s.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:4},children:s.jsx(j,{count:f,page:u,onChange:A,color:"primary",size:"large",showFirstButton:!0,showLastButton:!0})})]})})};E.displayName="SearchPage";const B=r.memo(E);export{B as default};
