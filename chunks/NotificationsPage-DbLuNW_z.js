import{R as e,r as s,j as a,q as i,s as r,k as t,x as n,B as o,T as c,u as l,y as d,d as x,C as h,m,z as p,S as j,A as u}from"./mui-core-BpoTvZsj.js";import{u as g}from"./useMatchRequests-d-04QxLu.js";import{a as b,j as y,k as v,R as f}from"./mui-icons-Bcg_AGA-.js";import{R as k}from"../index-BF7ALLnG.js";import{b as z}from"./vendor-47kkluUf.js";import"./skillsCache-DM44Hx6q.js";import"./http-Dos3PyFQ.js";const w=e.memo(({request:e,onAccept:m,onReject:p,isProcessing:j})=>{const u=z(),{id:g,emisor:f={},creado_en:w}=e,{id:C,nombre:R="Usuario",apellido:S="",media:q,foto_perfil:A,habilidades_ofrecer:I=[],habilidades_aprender:_=[]}=f,W=q||A,B=s.useCallback(()=>{u(k.USUARIO_BY_ID(C))},[C,u]),D=(e,s)=>e&&"object"==typeof e?e.id??e.key??e.value??`skill-${s}`:e??`skill-${s}`,P=e=>e&&"object"==typeof e?e.nombre||e.nombre_habilidad||e.name||String(e.id??""):String(e||""),$=s.useCallback(()=>{m(g)},[g,m]),E=s.useCallback(()=>{p(g)},[g,p]);return a.jsxs(i,{sx:{mb:2,"&:hover":{boxShadow:3,transform:"translateY(-2px)",transition:"all 0.2s"}},children:[a.jsx(r,{children:a.jsxs(t,{direction:"row",spacing:2,alignItems:"flex-start",children:[a.jsx(n,{src:W,alt:`${R} ${S}`,sx:{width:60,height:60},children:!W&&a.jsx(b,{})}),a.jsxs(o,{sx:{flex:1},children:[a.jsxs(c,{variant:"h6",gutterBottom:!0,children:[R," ",S]}),a.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"Te ha enviado una solicitud de match"}),I.length>0&&a.jsxs(o,{sx:{mb:1},children:[a.jsx(c,{variant:"caption",color:"text.secondary",display:"block",children:"Puede enseñar:"}),a.jsxs(t,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[I.slice(0,3).map((e,s)=>a.jsx(l,{label:P(e),size:"small",color:"primary",variant:"outlined",sx:{mt:.5}},D(e,s))),I.length>3&&a.jsx(l,{label:"+"+(I.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),_.length>0&&a.jsxs(o,{children:[a.jsx(c,{variant:"caption",color:"text.secondary",display:"block",children:"Quiere aprender:"}),a.jsxs(t,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[_.slice(0,3).map((e,s)=>a.jsx(l,{label:P(e),size:"small",color:"secondary",variant:"outlined",sx:{mt:.5}},D(e,s))),_.length>3&&a.jsx(l,{label:"+"+(_.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),a.jsx(c,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:new Date(w).toLocaleString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]})]})}),a.jsxs(d,{sx:{justifyContent:"space-between",px:2,pb:2},children:[a.jsx(x,{size:"small",onClick:B,disabled:j,children:"Ver Perfil"}),a.jsxs(t,{direction:"row",spacing:1,children:[a.jsx(x,{variant:"outlined",color:"error",startIcon:j?a.jsx(h,{size:16}):a.jsx(y,{}),onClick:E,disabled:j,size:"small",children:"Rechazar"}),a.jsx(x,{variant:"contained",color:"success",startIcon:j?a.jsx(h,{size:16}):a.jsx(v,{}),onClick:$,disabled:j,size:"small",children:"Aceptar"})]})]})]})}),C=()=>{const{requests:s,loading:i,error:r,actionLoading:n,acceptRequest:l,rejectRequest:d,fetchRequests:b}=g(),[y,v]=e.useState({open:!1,message:"",severity:"success"}),k=async e=>{const s=await l(e);s.success?v({open:!0,message:"¡Match aceptado! Ahora pueden chatear",severity:"success"}):v({open:!0,message:s.error||"Error al aceptar solicitud",severity:"error"})},z=async e=>{const s=await d(e);s.success?v({open:!0,message:"Solicitud rechazada",severity:"info"}):v({open:!0,message:s.error||"Error al rechazar solicitud",severity:"error"})};return i?a.jsx(o,{sx:{display:"flex",justifyContent:"center",py:12},children:a.jsx(h,{})}):r?a.jsx(m,{maxWidth:"md",sx:{py:4},children:a.jsx(p,{sx:{p:3,bgcolor:"error.light"},children:a.jsx(c,{color:"error.dark",variant:"h6",children:r})})}):a.jsxs(m,{maxWidth:"md",sx:{py:4},children:[a.jsxs(t,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,mb:2,children:[a.jsxs(o,{children:[a.jsx(c,{variant:"h4",fontWeight:"bold",children:"Notificaciones"}),a.jsxs(c,{variant:"body2",color:"text.secondary",children:["Solicitudes de Match (",s.length,")"]})]}),a.jsx(x,{variant:"outlined",startIcon:i?a.jsx(h,{size:16}):a.jsx(f,{}),onClick:b,disabled:i,children:i?"Actualizando…":"Actualizar"})]}),a.jsx(o,{sx:{mt:2},children:0===s.length?a.jsxs(p,{sx:{p:6,textAlign:"center",mt:2},children:[a.jsx(c,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No tienes solicitudes de match pendientes"}),a.jsx(c,{variant:"body2",color:"text.secondary",children:"Las nuevas solicitudes aparecerán aquí cuando alguien solicite un match."})]}):a.jsx(o,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:s.map(e=>a.jsx(w,{request:e,onAccept:k,onReject:z,isProcessing:n===e.id},e.id))})}),a.jsx(j,{open:y.open,autoHideDuration:4e3,onClose:()=>v({...y,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(u,{onClose:()=>v({...y,open:!1}),severity:y.severity,sx:{width:"100%"},children:y.message})})]})};export{C as default};
