import{r as e}from"./mui-core-CIRgtlGz.js";import{a as r,c as a,S as s,U as t}from"../index-Dz5qx50A.js";import{f as i,e as c}from"./skillsCache-DGpitEsO.js";const l=()=>{const{user:l}=r(),[n,o]=e.useState([]),[u,d]=e.useState(!1),[p,m]=e.useState(null),[f,h]=e.useState(null),y=e.useRef(!0),_=e.useCallback(async()=>{try{d(!0);const[e,r]=await Promise.all([a.get(s.listar),i()]),n=e.data.filter(e=>("indefinido"===e.estado||"pendiente"===e.estado)&&e.recipiente===l?.id),u=await Promise.all(n.map(async e=>{try{const s=(await a.get(t.detalle(e.emisor))).data;return{...e,emisor:{...s,habilidades_ofrecer:c(s.habilidades_que_se_saben,r),habilidades_aprender:c(s.habilidades_por_aprender,r)}}}catch(s){return{...e,emisor:{id:e.emisor,nombre:"Usuario",apellido:"",habilidades_ofrecer:[],habilidades_aprender:[]}}}}));y.current&&(o(u),m(null))}catch(e){const r=e.response?.data?.message||"Error al cargar solicitudes";y.current&&m(r)}finally{y.current&&d(!1)}},[l?.id]),b=e.useCallback(async e=>{try{return h(e),await a.post("/solicitudes-match/",{recipiente:e}),await _(),m(null),{success:!0}}catch(r){let e="Error al enviar solicitud";if(r.response?.data){const a=r.response.data;a.message?e=a.message:a.error?e=a.error:a.non_field_errors&&Array.isArray(a.non_field_errors)?e=a.non_field_errors[0]:a.detail&&(e=a.detail)}return m(e),{success:!1,error:e}}finally{h(null)}},[_]),g=e.useCallback(async e=>{try{return h(e),await a.post(`/solicitudes-match/${e}/aceptar/`),await _(),m(null),{success:!0}}catch(r){const e=r.response?.data?.message||r.response?.data?.error||"Error al aceptar solicitud";return m(e),{success:!1,error:e}}finally{h(null)}},[_]),w=e.useCallback(async e=>{try{return h(e),await a.post(`/solicitudes-match/${e}/rechazar/`),await _(),m(null),{success:!0}}catch(r){const e=r.response?.data?.message||r.response?.data?.error||"Error al rechazar solicitud";return m(e),{success:!1,error:e}}finally{h(null)}},[_]);return e.useEffect(()=>(y.current=!0,_(),()=>{y.current=!1}),[_]),{requests:n,loading:u,error:p,actionLoading:f,fetchRequests:_,sendRequest:b,acceptRequest:g,rejectRequest:w}};export{l as u};
