import{R as e,j as s,q as i,s as r,k as a,x as t,B as n,T as o,u as c,y as l,d,C as x,m as h,z as m,S as p,A as j}from"./mui-core-BpoTvZsj.js";import{a as u,j as g,k as y,R as b}from"./mui-icons-58CkGrMT.js";import{u as v}from"./useMatchRequests-X4yQFILk.js";import{R as f}from"../index-DnYbmb9J.js";import{b as z}from"./vendor-47kkluUf.js";import"./skillsCache-DrFCtLmv.js";import"./http-Dos3PyFQ.js";const w=e.memo(({request:e,onAccept:h,onReject:m,isProcessing:p})=>{const j=z(),{id:b,emisor:v={},creado_en:w}=e,{id:k,nombre:C="Usuario",apellido:R="",media:S,foto_perfil:q,habilidades_ofrecer:A=[],habilidades_aprender:I=[]}=v,_=S||q,W=(e,s)=>e&&"object"==typeof e?e.id??e.key??e.value??`skill-${s}`:e??`skill-${s}`,B=e=>e&&"object"==typeof e?e.nombre||e.nombre_habilidad||e.name||String(e.id??""):String(e||"");return s.jsxs(i,{sx:{mb:2,"&:hover":{boxShadow:3,transform:"translateY(-2px)",transition:"all 0.2s"}},children:[s.jsx(r,{children:s.jsxs(a,{direction:"row",spacing:2,alignItems:"flex-start",children:[s.jsx(t,{src:_,alt:`${C} ${R}`,sx:{width:60,height:60},children:!_&&s.jsx(u,{})}),s.jsxs(n,{sx:{flex:1},children:[s.jsxs(o,{variant:"h6",gutterBottom:!0,children:[C," ",R]}),s.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"Te ha enviado una solicitud de match"}),A.length>0&&s.jsxs(n,{sx:{mb:1},children:[s.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Puede enseñar:"}),s.jsxs(a,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[A.slice(0,3).map((e,i)=>s.jsx(c,{label:B(e),size:"small",color:"primary",variant:"outlined",sx:{mt:.5}},W(e,i))),A.length>3&&s.jsx(c,{label:"+"+(A.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),I.length>0&&s.jsxs(n,{children:[s.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:"Quiere aprender:"}),s.jsxs(a,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[I.slice(0,3).map((e,i)=>s.jsx(c,{label:B(e),size:"small",color:"secondary",variant:"outlined",sx:{mt:.5}},W(e,i))),I.length>3&&s.jsx(c,{label:"+"+(I.length-3),size:"small",variant:"outlined",sx:{mt:.5}})]})]}),s.jsx(o,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:new Date(w).toLocaleString("es-ES",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]})]})}),s.jsxs(l,{sx:{justifyContent:"space-between",px:2,pb:2},children:[s.jsx(d,{size:"small",onClick:()=>{j(f.USUARIO_BY_ID(k))},disabled:p,children:"Ver Perfil"}),s.jsxs(a,{direction:"row",spacing:1,children:[s.jsx(d,{variant:"outlined",color:"error",startIcon:p?s.jsx(x,{size:16}):s.jsx(g,{}),onClick:()=>{m(b)},disabled:p,size:"small",children:"Rechazar"}),s.jsx(d,{variant:"contained",color:"success",startIcon:p?s.jsx(x,{size:16}):s.jsx(y,{}),onClick:()=>{h(b)},disabled:p,size:"small",children:"Aceptar"})]})]})]})}),k=()=>{const{requests:i,loading:r,error:t,actionLoading:c,acceptRequest:l,rejectRequest:u,fetchRequests:g}=v(),[y,f]=e.useState({open:!1,message:"",severity:"success"}),z=async e=>{const s=await l(e);s.success?f({open:!0,message:"¡Match aceptado! Ahora pueden chatear",severity:"success"}):f({open:!0,message:s.error||"Error al aceptar solicitud",severity:"error"})},k=async e=>{const s=await u(e);s.success?f({open:!0,message:"Solicitud rechazada",severity:"info"}):f({open:!0,message:s.error||"Error al rechazar solicitud",severity:"error"})};return r?s.jsx(n,{sx:{display:"flex",justifyContent:"center",py:12},children:s.jsx(x,{})}):t?s.jsx(h,{maxWidth:"md",sx:{py:4},children:s.jsx(m,{sx:{p:3,bgcolor:"error.light"},children:s.jsx(o,{color:"error.dark",variant:"h6",children:t})})}):s.jsxs(h,{maxWidth:"md",sx:{py:4},children:[s.jsxs(a,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,mb:2,children:[s.jsxs(n,{children:[s.jsx(o,{variant:"h4",fontWeight:"bold",children:"Notificaciones"}),s.jsxs(o,{variant:"body2",color:"text.secondary",children:["Solicitudes de Match (",i.length,")"]})]}),s.jsx(d,{variant:"outlined",startIcon:r?s.jsx(x,{size:16}):s.jsx(b,{}),onClick:g,disabled:r,children:r?"Actualizando…":"Actualizar"})]}),s.jsx(n,{sx:{mt:2},children:0===i.length?s.jsxs(m,{sx:{p:6,textAlign:"center",mt:2},children:[s.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No tienes solicitudes de match pendientes"}),s.jsx(o,{variant:"body2",color:"text.secondary",children:"Las nuevas solicitudes aparecerán aquí cuando alguien solicite un match."})]}):s.jsx(n,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:i.map(e=>s.jsx(w,{request:e,onAccept:z,onReject:k,isProcessing:c===e.id},e.id))})}),s.jsx(p,{open:y.open,autoHideDuration:4e3,onClose:()=>f({...y,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(j,{onClose:()=>f({...y,open:!1}),severity:y.severity,sx:{width:"100%"},children:y.message})})]})};export{k as default};
